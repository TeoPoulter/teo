<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Iman Hub</title>
  <!-- Poppins font for consistent typography -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /*****************************************
     * EXACT ANIMATED BACKGROUND SNIPPET
     *****************************************/
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000; /* fallback background */
      overflow-x: hidden; /* allow vertical scroll for content */
      overflow-y: auto;
      font-family: 'Poppins', sans-serif;
    }
    .background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, #000000, #000000 50%, #b49f5e 100%);
      z-index: 1;
    }
    .pattern {
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: url('https://i.imgur.com/rxD6yFb.png');
      background-size: 100px 100px;
      opacity: 0.05;
      animation: rotate 60s linear infinite;
    }
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .corner {
      position: absolute;
      background-size: contain;
      background-repeat: no-repeat;
      width: 20vw;
      height: 20vw;
      max-width: 250px;
      max-height: 250px;
      z-index: 2;
      filter: grayscale(1) brightness(0.2);
    }
    .top-left {
      top: 0;
      left: 0;
      background-image: url('https://i.imgur.com/8Fx9W9u.png');
    }
    .top-right {
      top: 0;
      right: 0;
      background-image: url('https://i.imgur.com/kBZivxG.png');
    }
    .bottom-left {
      bottom: 0;
      left: 0;
      background-image: url('https://i.imgur.com/V1z0fyO.png');
    }
    .bottom-right {
      bottom: 0;
      right: 0;
      background-image: url('https://i.imgur.com/YuU3nYm.png');
    }
    @media (max-width: 600px) {
      .corner {
        width: 35vw;
        height: 35vw;
      }
    }
    /*****************************************
     * END ANIMATED BACKGROUND SNIPPET
     *****************************************/

    body {
      color: #f5f5f5; /* override text color to keep it visible */
    }

    .container {
      position: relative;
      z-index: 5;
      max-width: 1200px;
      margin: 40px auto 60px auto; /* reduced top margin */
      padding: 20px;
      background: none;
      animation: fadeSlideIn 1.2s ease forwards;
      opacity: 0;
      transform: translateY(20px);
      text-align: center;
    }
    @keyframes fadeSlideIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Iman Hub heading - gold color scheme, centered */
    h1 {
      font-size: 3rem;
      margin-bottom: 20px;
      background: linear-gradient(90deg, #9C824A, #b49f5e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 8px rgba(180,159,94,0.4);
      transition: transform 0.3s ease, letter-spacing 0.3s ease;
      display: inline-block;
    }
    h1:hover {
      transform: scale(1.04) translateY(-2px);
      letter-spacing: 1px;
    }

    /* Menu (4 category buttons) */
    .menu {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 40px;
      flex-wrap: wrap; /* so buttons wrap on small screens */
    }
    .menu button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s, box-shadow 0.3s, letter-spacing 0.3s;
      box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.2);
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #7f6a35, #b49f5e);
    }
    .menu button:hover {
      transform: scale(1.06);
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.4);
      letter-spacing: 1px;
      background: linear-gradient(135deg, #b49f5e, #7f6a35);
    }

    /* Filter Toggle & Panel */
    .filter-toggle-btn {
      margin: 0 auto 20px auto;
      display: block;
      background-color: #b49f5e;
      color: #fff;
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .filter-toggle-btn:hover {
      transform: scale(1.05);
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.4);
    }

    #filterContainer {
      display: none; /* hidden by default, toggled by JS */
      margin: 0 auto 30px auto;
      width: 80%;
      max-width: 700px;
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
      text-align: left; /* keep content left, center container overall */
    }
    .filter-section {
      margin-bottom: 20px;
    }
    .filter-section label {
      font-weight: 600;
      margin-right: 10px;
    }
    .filter-section input[type="radio"] {
      display: none; /* hide the original inputs */
    }

    /* 
       New custom toggle groups for Type and Orientation 
       to "use our own UI for selecting the modes"
    */
    .filter-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 20px;
    }
    .toggle-group {
      display: inline-flex;
      gap: 8px;
    }
    .toggle-group button {
      background: #2f2f2f;
      border: 1px solid #444;
      padding: 8px 16px;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.3s;
    }
    .toggle-group button:hover {
      box-shadow: 0 0 8px rgba(180,159,94,0.6);
    }
    .toggle-group button.active {
      background: linear-gradient(135deg, #b49f5e, #7f6a35);
      border-color: #b49f5e;
    }

    /* Double slider container */
    .slider-container {
      position: relative;
      height: 40px;
      margin-top: 10px;
    }
    .slider-container input[type="range"] {
      position: absolute;
      width: 100%;
      top: 14px; /* Enough offset so we can place the rangeValue below */
      -webkit-appearance: none;
      background: none;
      pointer-events: none; /* We'll handle pointer events with a pseudo-element for track */
      z-index: 3; /* ensure thumbs appear over the line */
    }
    .slider-container input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 16px;
      width: 16px;
      background: #b49f5e;
      border-radius: 50%;
      border: 2px solid #fff;
      cursor: pointer;
      pointer-events: auto; /* re-enable pointer for the thumb */
      position: relative;
      z-index: 4;
    }
    .slider-container input[type="range"]::-moz-range-thumb {
      height: 16px;
      width: 16px;
      background: #b49f5e;
      border-radius: 50%;
      border: 2px solid #fff;
      cursor: pointer;
      pointer-events: auto;
      position: relative;
      z-index: 4;
    }
    /* The track: we simulate with a single background behind both sliders */
    .slider-container::before {
      content: '';
      position: absolute;
      top: 21px; /* center line behind the thumbs */
      left: 0;
      right: 0;
      height: 2px;
      background: #aaa;
      z-index: 1;
    }
    /* The highlighted range between minRange and maxRange */
    .slider-track {
      position: absolute;
      top: 21px;
      height: 2px;
      background: #fff;
      z-index: 2;
    }
    .rangeValue {
      position: absolute;
      background: #1a1a1a;
      padding: 2px 5px;
      color: #fff;
      font-size: 0.8rem;
      border-radius: 4px;
      transform: translateX(-50%);
      white-space: nowrap;
      z-index: 5;
    }

    /* Additional numeric labels at the ends for clarity */
    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: #ccc;
      margin-top: 4px;
    }

    /* Content sections (for multiple categories) */
    .content {
      display: none;
    }
    .content.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /*
     * We define different aspect-ratios and sizes
     * for portrait vs. landscape .grid-item
    */
    .grid-item {
      background: #111;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      position: relative;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    /* For portrait items: aspect ratio ~ 3:5 */
    .grid-item[data-orientation="portrait"] {
      aspect-ratio: 3/5;
      width: 150px;
      height: auto;
    }
    /* For landscape items: aspect ratio ~16:9 */
    .grid-item[data-orientation="landscape"] {
      aspect-ratio: 16/9;
      width: 400px; /* increased width for all landscape videos */
      height: auto;
    }
    .grid-item::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0.3), transparent 60%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .grid-item:hover::before {
      opacity: 1;
    }
    .grid-item:hover {
      transform: scale(1.03);
      box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.5);
    }
    /* Green border after completed */
    .grid-item.completed {
      border: 3px solid #2ecc71; /* green color */
      box-shadow: 0px 0px 10px rgba(46, 204, 113, 0.5);
    }

    /* We'll use a small <video> overlay on each grid item when hovering */
    .preview-video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none; /* so clicks go through to the parent .grid-item */
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 10;
    }
    .preview-video.show {
      opacity: 1;
    }

    /* Full-page overlay for the video (no native UI) */
    .video-overlay {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.9);
      opacity: 0;
      visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.4s ease, visibility 0.4s ease;
      z-index: 9999;
    }
    .video-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* 
      The container that wraps the video. 
      We'll programmatically expand its height so the progress bar is never overlapped.
    */
    .video-container {
      position: relative;
      border: 3px solid #fff;
      border-radius: 8px;
      max-width: 90vw; 
      max-height: 90vh;
      overflow: hidden;
      z-index: 2;
      display: flex;
      flex-direction: column;
      pointer-events: auto; /* let clicks register inside */
    }
    /* The actual video covers the container 100% in both directions. */
    .video-container video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* The bar at the bottom for navigation */
    .video-nav-bar {
      position: absolute;
      bottom: 5px; /* so it won't overlap portrait videos */
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      max-width: 80%;
      display: flex;
      align-items: center; /* align items vertically center */
      gap: 10px;           /* spacing between time & bar */
      z-index: 3;
      pointer-events: auto;
    }
    .video-progress {
      flex: 1; 
      background: rgba(255,255,255,0.2);
      height: 8px;
      border-radius: 4px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: background 0.2s;
    }
    .video-progress:hover {
      background: rgba(255,255,255,0.3);
    }
    .video-progress-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      background: #fff;
      width: 0%;
      transition: width 0.1s linear; /* Smooth transition */
    }

    /* Time labels (elapsed, total) on each side of the progress bar */
    .video-time-left,
    .video-time-right {
      color: #fff;
      font-size: 0.9rem;
      min-width: 40px;
      text-align: center;
    }

    /* Skip indicators for double-click */
    .skip-message {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2rem;
      color: #fff;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      text-shadow: 0 0 10px rgba(0,0,0,0.8);
      z-index: 5;
    }
    .skip-left {
      left: 10%;
    }
    .skip-right {
      right: 10%;
    }
    .skip-message.show {
      opacity: 1;
    }

    /*
    =======================================
    Voice Note Player Styles
    =======================================
    */
    .voice-note-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    .voice-note-player {
      position: relative;
      background: #1a1a1a;
      border-radius: 12px;
      width: 100%;
      max-width: 600px;
      padding: 14px 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .voice-note-player.completed {
      border: 2px solid #2ecc71;
    }
    .player-top-row {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
    }
    .play-pause-btn {
      flex-shrink: 0;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #b49f5e, #7f6a35);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .play-pause-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 8px rgba(180,159,94,0.6);
    }
    .icon {
      width: 24px;
      height: 24px;
      fill: #fff;
      position: absolute;
      transition: opacity 0.2s;
    }
    .icon-pause {
      opacity: 0; /* Start with pause icon hidden */
    }
    .waveform {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 2px;
      cursor: pointer; /* so user sees they can scrub through */
    }
    .wave-bar {
      width: 3px;
      height: 20px; /* will be randomized by JS, but let's set default */
      background: linear-gradient(135deg, #b49f5e, #7f6a35);
      border-radius: 2px;
      animation: wave-animation 1.2s infinite ease-in-out;
      animation-delay: calc(0.05s * var(--i));
    }
    @keyframes wave-animation {
      0% {
        transform: scaleY(0.4);
        opacity: 0.7;
      }
      50% {
        transform: scaleY(1);
        opacity: 1;
      }
      100% {
        transform: scaleY(0.4);
        opacity: 0.7;
      }
    }
    .voice-note-player.paused .wave-bar {
      animation-play-state: paused;
    }
    .time-display {
      flex-shrink: 0;
      font-size: 0.9rem;
      color: #ccc;
    }
    .recording-info {
      font-size: 0.9rem;
      color: #ccc;
      opacity: 0.9;
      margin-left: 4px;
    }

    .completed-button {
      position: fixed; /* so it's on the left middle of the screen */
      left: 2%;
      top: 50%;
      transform: translateY(-50%) translateX(-150px);
      background-color: #2ecc71;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      padding: 16px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease, transform 0.4s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 20000; /* on top of everything */
    }
    .completed-button.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(-50%) translateX(0);
    }

    /* Grid layout for items */
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 20px;
      padding: 20px;
      justify-items: center; 
    }
  </style>
</head>
<body>
  <!-- Mobile Detection: if user is on a mobile device or has a narrow screen, show message only -->
  <script>
    if (/Mobi|Android/i.test(navigator.userAgent) || window.innerWidth < 768) {
      document.body.innerHTML = '<div style="display:flex; align-items:center; justify-content:center; height:100vh; font-family: Poppins, sans-serif; font-size:1.5rem; color:#fff; background:#000;">Not yet adapted to Mobile - try a bigger screen!</div>';
    }
  </script>

  <!-- Animated background -->
  <div class="background">
    <div class="pattern"></div>
    <div class="corner top-left"></div>
    <div class="corner top-right"></div>
    <div class="corner bottom-left"></div>
    <div class="corner bottom-right"></div>
  </div>

  <!-- Main content (above background) -->
  <div class="container">
    <h1>Iman Hub</h1>

    <!-- FILTER UI START -->
    <button class="filter-toggle-btn" onclick="toggleFilterUI()">Show Filters</button>
    <div id="filterContainer">
      <div class="filter-row">
        <div class="filter-section">
          <label>Type:</label>
          <!-- Our custom toggle group for Type -->
          <div class="toggle-group type-toggle-group">
            <button type="button" data-value="all">All</button>
            <button type="button" data-value="video">Video</button>
            <button type="button" data-value="audio">Audio</button>
          </div>
          <!-- Hidden radio inputs for type -->
          <input type="radio" name="filterType" value="all" checked>
          <input type="radio" name="filterType" value="video">
          <input type="radio" name="filterType" value="audio">
        </div>

        <div class="filter-section">
          <label>Orientation:</label>
          <!-- Our custom toggle group for Orientation -->
          <div class="toggle-group orientation-toggle-group">
            <button type="button" data-value="all">All</button>
            <button type="button" data-value="portrait">Portrait</button>
            <button type="button" data-value="landscape">Landscape</button>
          </div>
          <!-- Hidden radio inputs for orientation -->
          <input type="radio" name="filterOrientation" value="all" checked>
          <input type="radio" name="filterOrientation" value="portrait">
          <input type="radio" name="filterOrientation" value="landscape">
        </div>
      </div>

      <div class="filter-section">
        <label>Length (minutes):</label>
        <div class="slider-container">
          <div class="slider-track" id="sliderTrack"></div>
          <input type="range" id="minRange" min="0" max="120" step="1" value="0">
          <input type="range" id="maxRange" min="0" max="120" step="1" value="120">
          <span class="rangeValue" id="minRangeValue">0</span>
          <span class="rangeValue" id="maxRangeValue">120</span>
        </div>
        <div class="slider-labels">
          <div>0</div>
          <div>120</div>
        </div>
      </div>
    </div>
    <!-- FILTER UI END -->

    <!-- Menu with 4 category buttons -->
    <div class="menu">
      <button onclick="showCategory('reminders')">Reminders</button>
      <button onclick="showCategory('education')">Education</button>
      <button onclick="showCategory('favRecitations')">Favourite Recitations</button>
      <button onclick="showCategory('salahRecordings')">Salah Recordings</button>
    </div>

    <!-- REMINDERS SECTION -->
    <div id="reminders" class="content active">
      <div class="grid">
        <!-- REMINDERS CONTENT 1 -->
        <div 
          class="grid-item"
          data-video-id="video1"
          data-video-src="https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000033646.mp4"
          data-type="video"
          data-orientation="portrait"
          data-length="1"
          onclick="openOverlay('video1', 'https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000033646.mp4')"
          style="background-image: url('https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/thumbnails/Screenshot+2025-02-11+210429.png');"
          onmouseover="startPreview(event)"
          onmouseleave="stopPreview(event)"
        ></div>

        <!-- REMINDERS CONTENT 2 -->
        <div 
          class="grid-item"
          data-video-id="video2"
          data-video-src="https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000034631.mp4"
          data-type="video"
          data-orientation="portrait"
          data-length="1"
          onclick="openOverlay('video2', 'https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000034631.mp4')"
          style="background-image: url('https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/thumbnails/Screenshot+2025-02-11+212649.png');"
          onmouseover="startPreview(event)"
          onmouseleave="stopPreview(event)"
        ></div>

        <!-- REMINDERS CONTENT 3 -->
        <div 
          class="grid-item"
          data-video-id="video3"
          data-video-src="https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000034633.mp4"
          data-type="video"
          data-orientation="portrait"
          data-length="1"
          onclick="openOverlay('video3', 'https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000034633.mp4')"
          style="background-image: url('https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/thumbnails/Screenshot+2025-02-11+213005.png');"
          onmouseover="startPreview(event)"
          onmouseleave="stopPreview(event)"
        ></div>

        <!-- REMINDERS CONTENT 4 -->
        <div 
          class="grid-item"
          data-video-id="video4"
          data-video-src="https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000034634.mp4"
          data-type="video"
          data-orientation="portrait"
          data-length="1"
          onclick="openOverlay('video4', 'https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000034634.mp4')"
          style="background-image: url('https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/thumbnails/Screenshot+2025-02-11+214019.png');"
          onmouseover="startPreview(event)"
          onmouseleave="stopPreview(event)"
        ></div>

        <!-- REMINDERS CONTENT 5 -->
        <div 
          class="grid-item"
          data-video-id="video5"
          data-video-src="https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000034638.mp4"
          data-type="video"
          data-orientation="portrait"
          data-length="1"
          onclick="openOverlay('video5', 'https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/1000034638.mp4')"
          style="background-image: url('https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/thumbnails/Screenshot+2025-02-11+214028.png');"
          onmouseover="startPreview(event)"
          onmouseleave="stopPreview(event)"
        ></div>
      </div>



      <!-- Extra grid for newly added Reminders videos -->
      <div class="grid" id="remindersGridExtra"></div>
    </div>

    <!-- EDUCATION SECTION -->
    <div id="education" class="content">
      <div class="grid">
        <!-- EDUCATION CONTENT 1 (LANDSCAPE, 64 MIN, VIDEO) -->
        <div
          class="grid-item"
          data-video-id="videoEdu1"
          data-video-src="https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/saveinsta.cc_720p-the-prophets-prayer-according-to-authentic-ahadith-assim-al-hakeem.mp4"
          data-type="video"
          data-orientation="landscape"
          data-length="64"
          onclick="openOverlay('videoEdu1', 'https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/saveinsta.cc_720p-the-prophets-prayer-according-to-authentic-ahadith-assim-al-hakeem.mp4')"
          style="background-image: url('https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/thumbnails/Screenshot+2025-02-17+185523.png');"
          onmouseover="startPreview(event)"
          onmouseleave="stopPreview(event)"
        ></div>
      </div>

      <!-- Extra grid for newly added Education videos -->
      <div class="grid" id="educationGridExtra"></div>
    </div>

    <!-- Favourite Recitations Section -->
    <div id="favRecitations" class="content">
      <!-- FIRST AUDIO PLAYER -->
      <div class="voice-note-container">
        <div class="voice-note-player paused" id="voiceNotePlayer1"
             data-type="audio"
             data-orientation="none"
             data-length="3">
          <div class="player-top-row">
            <div class="play-pause-btn" onclick="togglePlay1()">
              <svg class="icon icon-play" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"></path>
              </svg>
              <svg class="icon icon-pause" viewBox="0 0 24 24">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
              </svg>
            </div>
            <div class="waveform" id="waveform1">
              <!-- We'll generate 90 bars with random heights via JS -->
              <div class="wave-bar" style="--i:1"></div><div class="wave-bar" style="--i:2"></div>
              <div class="wave-bar" style="--i:3"></div><div class="wave-bar" style="--i:4"></div>
              <div class="wave-bar" style="--i:5"></div><div class="wave-bar" style="--i:6"></div>
              <div class="wave-bar" style="--i:7"></div><div class="wave-bar" style="--i:8"></div>
              <div class="wave-bar" style="--i:9"></div><div class="wave-bar" style="--i:10"></div>
              <div class="wave-bar" style="--i:11"></div><div class="wave-bar" style="--i:12"></div>
              <div class="wave-bar" style="--i:13"></div><div class="wave-bar" style="--i:14"></div>
              <div class="wave-bar" style="--i:15"></div><div class="wave-bar" style="--i:16"></div>
              <div class="wave-bar" style="--i:17"></div><div class="wave-bar" style="--i:18"></div>
              <div class="wave-bar" style="--i:19"></div><div class="wave-bar" style="--i:20"></div>
              <div class="wave-bar" style="--i:21"></div><div class="wave-bar" style="--i:22"></div>
              <div class="wave-bar" style="--i:23"></div><div class="wave-bar" style="--i:24"></div>
              <div class="wave-bar" style="--i:25"></div><div class="wave-bar" style="--i:26"></div>
              <div class="wave-bar" style="--i:27"></div><div class="wave-bar" style="--i:28"></div>
              <div class="wave-bar" style="--i:29"></div><div class="wave-bar" style="--i:30"></div>
              <div class="wave-bar" style="--i:31"></div><div class="wave-bar" style="--i:32"></div>
              <div class="wave-bar" style="--i:33"></div><div class="wave-bar" style="--i:34"></div>
              <div class="wave-bar" style="--i:35"></div><div class="wave-bar" style="--i:36"></div>
              <div class="wave-bar" style="--i:37"></div><div class="wave-bar" style="--i:38"></div>
              <div class="wave-bar" style="--i:39"></div><div class="wave-bar" style="--i:40"></div>
              <div class="wave-bar" style="--i:41"></div><div class="wave-bar" style="--i:42"></div>
              <div class="wave-bar" style="--i:43"></div><div class="wave-bar" style="--i:44"></div>
              <div class="wave-bar" style="--i:45"></div><div class="wave-bar" style="--i:46"></div>
              <div class="wave-bar" style="--i:47"></div><div class="wave-bar" style="--i:48"></div>
              <div class="wave-bar" style="--i:49"></div><div class="wave-bar" style="--i:50"></div>
              <div class="wave-bar" style="--i:51"></div><div class="wave-bar" style="--i:52"></div>
              <div class="wave-bar" style="--i:53"></div><div class="wave-bar" style="--i:54"></div>
              <div class="wave-bar" style="--i:55"></div><div class="wave-bar" style="--i:56"></div>
              <div class="wave-bar" style="--i:57"></div><div class="wave-bar" style="--i:58"></div>
              <div class="wave-bar" style="--i:59"></div><div class="wave-bar" style="--i:60"></div>
              <div class="wave-bar" style="--i:61"></div><div class="wave-bar" style="--i:62"></div>
              <div class="wave-bar" style="--i:63"></div><div class="wave-bar" style="--i:64"></div>
              <div class="wave-bar" style="--i:65"></div><div class="wave-bar" style="--i:66"></div>
              <div class="wave-bar" style="--i:67"></div><div class="wave-bar" style="--i:68"></div>
              <div class="wave-bar" style="--i:69"></div><div class="wave-bar" style="--i:70"></div>
              <div class="wave-bar" style="--i:71"></div><div class="wave-bar" style="--i:72"></div>
              <div class="wave-bar" style="--i:73"></div><div class="wave-bar" style="--i:74"></div>
              <div class="wave-bar" style="--i:75"></div><div class="wave-bar" style="--i:76"></div>
              <div class="wave-bar" style="--i:77"></div><div class="wave-bar" style="--i:78"></div>
              <div class="wave-bar" style="--i:79"></div><div class="wave-bar" style="--i:80"></div>
              <div class="wave-bar" style="--i:81"></div><div class="wave-bar" style="--i:82"></div>
              <div class="wave-bar" style="--i:83"></div><div class="wave-bar" style="--i:84"></div>
              <div class="wave-bar" style="--i:85"></div><div class="wave-bar" style="--i:86"></div>
              <div class="wave-bar" style="--i:87"></div><div class="wave-bar" style="--i:88"></div>
              <div class="wave-bar" style="--i:89"></div><div class="wave-bar" style="--i:90"></div>
            </div>
            <div class="time-display" id="timeDisplay1">00:00 / 00:00</div>
          </div>
          <div class="recording-info">Surah 28 (Al-Qasas), Ayahs 71-83</div>
          <audio id="voiceNoteAudio1" src="https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp3/AlQasas-28_71-83.mp3"></audio>
        </div>
      </div>

      <!-- SECOND AUDIO PLAYER -->
      <div class="voice-note-container">
        <div class="voice-note-player paused" id="voiceNotePlayer2"
             data-type="audio"
             data-orientation="none"
             data-length="15">
          <div class="player-top-row">
            <div class="play-pause-btn" onclick="togglePlay2()">
              <svg class="icon icon-play" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"></path>
              </svg>
              <svg class="icon icon-pause" viewBox="0 0 24 24">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
              </svg>
            </div>
            <div class="waveform" id="waveform2">
              <!-- 90 bars again -->
              <div class="wave-bar" style="--i:1"></div><div class="wave-bar" style="--i:2"></div>
              <div class="wave-bar" style="--i:3"></div><div class="wave-bar" style="--i:4"></div>
              <div class="wave-bar" style="--i:5"></div><div class="wave-bar" style="--i:6"></div>
              <div class="wave-bar" style="--i:7"></div><div class="wave-bar" style="--i:8"></div>
              <div class="wave-bar" style="--i:9"></div><div class="wave-bar" style="--i:10"></div>
              <div class="wave-bar" style="--i:11"></div><div class="wave-bar" style="--i:12"></div>
              <div class="wave-bar" style="--i:13"></div><div class="wave-bar" style="--i:14"></div>
              <div class="wave-bar" style="--i:15"></div><div class="wave-bar" style="--i:16"></div>
              <div class="wave-bar" style="--i:17"></div><div class="wave-bar" style="--i:18"></div>
              <div class="wave-bar" style="--i:19"></div><div class="wave-bar" style="--i:20"></div>
              <div class="wave-bar" style="--i:21"></div><div class="wave-bar" style="--i:22"></div>
              <div class="wave-bar" style="--i:23"></div><div class="wave-bar" style="--i:24"></div>
              <div class="wave-bar" style="--i:25"></div><div class="wave-bar" style="--i:26"></div>
              <div class="wave-bar" style="--i:27"></div><div class="wave-bar" style="--i:28"></div>
              <div class="wave-bar" style="--i:29"></div><div class="wave-bar" style="--i:30"></div>
              <div class="wave-bar" style="--i:31"></div><div class="wave-bar" style="--i:32"></div>
              <div class="wave-bar" style="--i:33"></div><div class="wave-bar" style="--i:34"></div>
              <div class="wave-bar" style="--i:35"></div><div class="wave-bar" style="--i:36"></div>
              <div class="wave-bar" style="--i:37"></div><div class="wave-bar" style="--i:38"></div>
              <div class="wave-bar" style="--i:39"></div><div class="wave-bar" style="--i:40"></div>
              <div class="wave-bar" style="--i:41"></div><div class="wave-bar" style="--i:42"></div>
              <div class="wave-bar" style="--i:43"></div><div class="wave-bar" style="--i:44"></div>
              <div class="wave-bar" style="--i:45"></div><div class="wave-bar" style="--i:46"></div>
              <div class="wave-bar" style="--i:47"></div><div class="wave-bar" style="--i:48"></div>
              <div class="wave-bar" style="--i:49"></div><div class="wave-bar" style="--i:50"></div>
              <div class="wave-bar" style="--i:51"></div><div class="wave-bar" style="--i:52"></div>
              <div class="wave-bar" style="--i:53"></div><div class="wave-bar" style="--i:54"></div>
              <div class="wave-bar" style="--i:55"></div><div class="wave-bar" style="--i:56"></div>
              <div class="wave-bar" style="--i:57"></div><div class="wave-bar" style="--i:58"></div>
              <div class="wave-bar" style="--i:59"></div><div class="wave-bar" style="--i:60"></div>
              <div class="wave-bar" style="--i:61"></div><div class="wave-bar" style="--i:62"></div>
              <div class="wave-bar" style="--i:63"></div><div class="wave-bar" style="--i:64"></div>
              <div class="wave-bar" style="--i:65"></div><div class="wave-bar" style="--i:66"></div>
              <div class="wave-bar" style="--i:67"></div><div class="wave-bar" style="--i:68"></div>
              <div class="wave-bar" style="--i:69"></div><div class="wave-bar" style="--i:70"></div>
              <div class="wave-bar" style="--i:71"></div><div class="wave-bar" style="--i:72"></div>
              <div class="wave-bar" style="--i:73"></div><div class="wave-bar" style="--i:74"></div>
              <div class="wave-bar" style="--i:75"></div><div class="wave-bar" style="--i:76"></div>
              <div class="wave-bar" style="--i:77"></div><div class="wave-bar" style="--i:78"></div>
              <div class="wave-bar" style="--i:79"></div><div class="wave-bar" style="--i:80"></div>
              <div class="wave-bar" style="--i:81"></div><div class="wave-bar" style="--i:82"></div>
              <div class="wave-bar" style="--i:83"></div><div class="wave-bar" style="--i:84"></div>
              <div class="wave-bar" style="--i:85"></div><div class="wave-bar" style="--i:86"></div>
              <div class="wave-bar" style="--i:87"></div><div class="wave-bar" style="--i:88"></div>
              <div class="wave-bar" style="--i:89"></div><div class="wave-bar" style="--i:90"></div>
            </div>
            <div class="time-display" id="timeDisplay2">00:00 / 00:00</div>
          </div>
          <div class="recording-info">Surah 44 (Ad-Dukhan)</div>
          <audio id="voiceNoteAudio2" src="https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp3/Surah+Dukhan.mp3"></audio>
        </div>
      </div>

      <!-- Extra container for newly added Recitations audio -->
      <div id="favRecitationsExtra"></div>
    </div>

    <!-- Salah Recordings Section -->
    <div id="salahRecordings" class="content">
      <!-- THIRD AUDIO PLAYER -->
      <div class="voice-note-container">
        <div class="voice-note-player paused" id="voiceNotePlayer3"
             data-type="audio"
             data-orientation="none"
             data-length="5">
          <div class="player-top-row">
            <div class="play-pause-btn" onclick="togglePlay3()">
              <svg class="icon icon-play" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"></path>
              </svg>
              <svg class="icon icon-pause" viewBox="0 0 24 24">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
              </svg>
            </div>
            <div class="waveform" id="waveform3">
              <!-- 90 bars -->
              <div class="wave-bar" style="--i:1"></div><div class="wave-bar" style="--i:2"></div>
              <div class="wave-bar" style="--i:3"></div><div class="wave-bar" style="--i:4"></div>
              <div class="wave-bar" style="--i:5"></div><div class="wave-bar" style="--i:6"></div>
              <div class="wave-bar" style="--i:7"></div><div class="wave-bar" style="--i:8"></div>
              <div class="wave-bar" style="--i:9"></div><div class="wave-bar" style="--i:10"></div>
              <div class="wave-bar" style="--i:11"></div><div class="wave-bar" style="--i:12"></div>
              <div class="wave-bar" style="--i:13"></div><div class="wave-bar" style="--i:14"></div>
              <div class="wave-bar" style="--i:15"></div><div class="wave-bar" style="--i:16"></div>
              <div class="wave-bar" style="--i:17"></div><div class="wave-bar" style="--i:18"></div>
              <div class="wave-bar" style="--i:19"></div><div class="wave-bar" style="--i:20"></div>
              <div class="wave-bar" style="--i:21"></div><div class="wave-bar" style="--i:22"></div>
              <div class="wave-bar" style="--i:23"></div><div class="wave-bar" style="--i:24"></div>
              <div class="wave-bar" style="--i:25"></div><div class="wave-bar" style="--i:26"></div>
              <div class="wave-bar" style="--i:27"></div><div class="wave-bar" style="--i:28"></div>
              <div class="wave-bar" style="--i:29"></div><div class="wave-bar" style="--i:30"></div>
              <div class="wave-bar" style="--i:31"></div><div class="wave-bar" style="--i:32"></div>
              <div class="wave-bar" style="--i:33"></div><div class="wave-bar" style="--i:34"></div>
              <div class="wave-bar" style="--i:35"></div><div class="wave-bar" style="--i:36"></div>
              <div class="wave-bar" style="--i:37"></div><div class="wave-bar" style="--i:38"></div>
              <div class="wave-bar" style="--i:39"></div><div class="wave-bar" style="--i:40"></div>
              <div class="wave-bar" style="--i:41"></div><div class="wave-bar" style="--i:42"></div>
              <div class="wave-bar" style="--i:43"></div><div class="wave-bar" style="--i:44"></div>
              <div class="wave-bar" style="--i:45"></div><div class="wave-bar" style="--i:46"></div>
              <div class="wave-bar" style="--i:47"></div><div class="wave-bar" style="--i:48"></div>
              <div class="wave-bar" style="--i:49"></div><div class="wave-bar" style="--i:50"></div>
              <div class="wave-bar" style="--i:51"></div><div class="wave-bar" style="--i:52"></div>
              <div class="wave-bar" style="--i:53"></div><div class="wave-bar" style="--i:54"></div>
              <div class="wave-bar" style="--i:55"></div><div class="wave-bar" style="--i:56"></div>
              <div class="wave-bar" style="--i:57"></div><div class="wave-bar" style="--i:58"></div>
              <div class="wave-bar" style="--i:59"></div><div class="wave-bar" style="--i:60"></div>
              <div class="wave-bar" style="--i:61"></div><div class="wave-bar" style="--i:62"></div>
              <div class="wave-bar" style="--i:63"></div><div class="wave-bar" style="--i:64"></div>
              <div class="wave-bar" style="--i:65"></div><div class="wave-bar" style="--i:66"></div>
              <div class="wave-bar" style="--i:67"></div><div class="wave-bar" style="--i:68"></div>
              <div class="wave-bar" style="--i:69"></div><div class="wave-bar" style="--i:70"></div>
              <div class="wave-bar" style="--i:71"></div><div class="wave-bar" style="--i:72"></div>
              <div class="wave-bar" style="--i:73"></div><div class="wave-bar" style="--i:74"></div>
              <div class="wave-bar" style="--i:75"></div><div class="wave-bar" style="--i:76"></div>
              <div class="wave-bar" style="--i:77"></div><div class="wave-bar" style="--i:78"></div>
              <div class="wave-bar" style="--i:79"></div><div class="wave-bar" style="--i:80"></div>
              <div class="wave-bar" style="--i:81"></div><div class="wave-bar" style="--i:82"></div>
              <div class="wave-bar" style="--i:83"></div><div class="wave-bar" style="--i:84"></div>
              <div class="wave-bar" style="--i:85"></div><div class="wave-bar" style="--i:86"></div>
              <div class="wave-bar" style="--i:87"></div><div class="wave-bar" style="--i:88"></div>
              <div class="wave-bar" style="--i:89"></div><div class="wave-bar" style="--i:90"></div>
            </div>
            <div class="time-display" id="timeDisplay3">00:00 / 00:00</div>
          </div>
          <div class="recording-info">Sheikh Yasser Salah (Unknown Surah)</div>
          <audio id="voiceNoteAudio3" src="https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp3/Sheikh+Yasser+Salah+Unknown.mp3"></audio>
        </div>
      </div>

      <!-- Extra container for newly added Salah audio -->
      <div id="salahRecordingsExtra"></div>
    </div>

  </div>

  <!-- The overlay that shows the big no-UI video -->
  <div id="videoOverlay" class="video-overlay" onclick="overlayClickHandler(event)">
    <!-- We'll build the container + video + skip messages + bar in JS -->
  </div>

  <!-- The "Completed?" button, displayed in last 5 seconds of video -->
  <button class="completed-button" id="completedBtn" onclick="onCompletedClick()">Completed?</button>

  <script>
    /*
    Store completed items in localStorage
    We'll keep an object like: { "video1": true, "video2": false, ... , "voiceNotePlayer1": true, etc. }
    */
    let completedItems = {};

    // Attempt to load from localStorage
    function loadCompletedItems() {
      const data = localStorage.getItem('completedItems');
      if (data) {
        completedItems = JSON.parse(data);
      }
    }

    // Save to localStorage
    function saveCompletedItems() {
      localStorage.setItem('completedItems', JSON.stringify(completedItems));
    }

    let currentlyActiveItem = null; 
    let activeVideoEl = null;       

    // Switch visible category
    function showCategory(category) {
      // Hide all sections
      document.querySelectorAll(".content").forEach(el => el.classList.remove("active"));
      // Show only the chosen section
      document.getElementById(category).classList.add("active");
      // Also collapse the filter container if open
      document.getElementById('filterContainer').style.display = 'none';
      // Re-apply filters to the new section
      applyFilters();
    }

    // Toggle the filter UI panel
    function toggleFilterUI() {
      const fc = document.getElementById('filterContainer');
      if (fc.style.display === 'block') {
        fc.style.display = 'none';
      } else {
        fc.style.display = 'block';
      }
    }

    // Mark completed in DOM + localStorage
    function markAsCompleted(itemID) {
      completedItems[itemID] = true;
      saveCompletedItems();

      // If it's a video .grid-item
      const videoEl = document.querySelector(`.grid-item[data-video-id="${itemID}"]`);
      if (videoEl) {
        videoEl.classList.add('completed');
      }

      // If it's an audio .voice-note-player
      const audioEl = document.getElementById(itemID);
      if (audioEl) {
        audioEl.classList.add('completed');
      }
    }

    // We'll call this to apply .completed from localStorage data at page load
    function applyCompletedClasses() {
      for (let key in completedItems) {
        if (completedItems[key]) {
          const videoEl = document.querySelector(`.grid-item[data-video-id="${key}"]`);
          if (videoEl) {
            videoEl.classList.add('completed');
          }
          const audioEl = document.getElementById(key);
          if (audioEl) {
            audioEl.classList.add('completed');
          }
        }
      }
    }

    // OPEN OVERLAY FOR VIDEO
    function openOverlay(videoID, videoSrc) {
      if (!videoSrc) return; // if placeholder has no video
      currentlyActiveItem = videoID; 
      const overlay = document.getElementById('videoOverlay');
      
      // Build the markup with time labels around the progress bar
      overlay.innerHTML = `
        <div class="video-container" onclick="stopPropagation(event)" id="videoContainer">
          <video id="activeVideoEl" src="${videoSrc}" autoplay playsinline></video>
          <div class="skip-message skip-left" id="skipLeft">-10</div>
          <div class="skip-message skip-right" id="skipRight">+10</div>
        </div>
        <div class="video-nav-bar" onclick="stopPropagation(event)">
          <div class="video-time-left" id="videoTimeLeft">00:00</div>
          <div class="video-progress" onclick="handleVideoProgressClick(event)">
            <div class="video-progress-fill" id="videoProgressFill"></div>
          </div>
          <div class="video-time-right" id="videoTimeRight">00:00</div>
        </div>
      `;

      overlay.classList.add('active');

      activeVideoEl = document.getElementById('activeVideoEl');

      // Once metadata is loaded, adjust container size + a bit more for the progress bar
      activeVideoEl.addEventListener('loadedmetadata', () => {
        const videoRatio = activeVideoEl.videoWidth / activeVideoEl.videoHeight;
        const maxWidth = window.innerWidth * 0.9;  // 90% of viewport
        const maxHeight = window.innerHeight * 0.9; // 90% of viewport

        let containerWidth = maxWidth;
        let containerHeight = containerWidth / videoRatio;

        // If too tall, clamp
        if (containerHeight > maxHeight) {
          containerHeight = maxHeight;
          containerWidth = containerHeight * videoRatio;
        }

        // Add extra space for bottom bar
        containerHeight += 60; 

        const container = document.getElementById('videoContainer');
        container.style.width = containerWidth + 'px';
        container.style.height = containerHeight + 'px';
      });

      // Single-click => toggle play/pause, double-click => skip
      activeVideoEl.addEventListener('click', function(e) {
        if (e.detail === 2) {
          e.preventDefault();
          e.stopPropagation();
          handleVideoDoubleClick(e);
        } else if (e.detail === 1) {
          if (activeVideoEl.paused) {
            activeVideoEl.play();
          } else {
            activeVideoEl.pause();
          }
        }
      });

      activeVideoEl.addEventListener('timeupdate', handleVideoTimeUpdate);
      activeVideoEl.addEventListener('ended', () => {
        showCompletedButton();
      });
    }

    // If user clicks outside the .video-container or the nav bar, close overlay
    function overlayClickHandler(e) {
      // if the user clicked the overlay background (this element) directly, close
      if (e.target.id === 'videoOverlay') {
        closeOverlay();
      }
    }
    // Stop click from closing if clicked on the container or the bar
    function stopPropagation(e) {
      e.stopPropagation();
    }

    function closeOverlay() {
      const overlay = document.getElementById('videoOverlay');
      overlay.classList.remove('active');
      setTimeout(() => {
        overlay.innerHTML = '';
        activeVideoEl = null;
        hideCompletedButton();
      }, 400);
    }

    // Show "Completed?" button
    function showCompletedButton() {
      const btn = document.getElementById('completedBtn');
      btn.classList.add('show');
    }
    // Hide "Completed?" button
    function hideCompletedButton() {
      const btn = document.getElementById('completedBtn');
      btn.classList.remove('show');
    }
    function onCompletedClick() {
      if (currentlyActiveItem) {
        markAsCompleted(currentlyActiveItem);
      }
      closeOverlay();
    }

    // A helper to format time in MM:SS
    function formatTime(sec) {
      if (isNaN(sec)) return '00:00';
      const minutes = Math.floor(sec / 60);
      const seconds = Math.floor(sec % 60);
      return String(minutes).padStart(2,'0') + ':' + String(seconds).padStart(2,'0');
    }

    // Handle video time + progress bar
    function handleVideoTimeUpdate() {
      if (!activeVideoEl) return;
      const fraction = (activeVideoEl.currentTime / activeVideoEl.duration) || 0;
      const fillEl = document.getElementById('videoProgressFill');

      // Update progress bar fill
      if (fillEl) {
        fillEl.style.width = (fraction * 100) + '%';
      }

      // Update the time labels
      const elapsed = formatTime(activeVideoEl.currentTime);
      const total   = formatTime(activeVideoEl.duration);
      const videoTimeLeft = document.getElementById('videoTimeLeft');
      const videoTimeRight = document.getElementById('videoTimeRight');
      if (videoTimeLeft && videoTimeRight) {
        videoTimeLeft.textContent  = elapsed;
        videoTimeRight.textContent = total;
      }

      // Show/hide "Completed?" button in the last 5 seconds
      if (activeVideoEl.duration - activeVideoEl.currentTime <= 5) {
        showCompletedButton();
      } else {
        hideCompletedButton();
      }
    }

    // user clicks on the progress bar
    function handleVideoProgressClick(e) {
      if (!activeVideoEl || !activeVideoEl.duration) return;
      const rect = e.currentTarget.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const fraction = clickX / rect.width;
      activeVideoEl.currentTime = fraction * activeVideoEl.duration;
      e.stopPropagation();
    }

    // Double-click skip logic
    function handleVideoDoubleClick(e) {
      if (!activeVideoEl) return;
      const half = activeVideoEl.clientWidth / 2;
      if (e.offsetX > half) {
        skipForward(10);
        showSkipMessage('skipRight');
      } else {
        skipBackward(10);
        showSkipMessage('skipLeft');
      }
      // Force it to keep playing after skip
      activeVideoEl.play();
    }
    function skipForward(sec) {
      activeVideoEl.currentTime = Math.min(activeVideoEl.currentTime + sec, activeVideoEl.duration);
    }
    function skipBackward(sec) {
      activeVideoEl.currentTime = Math.max(activeVideoEl.currentTime - sec, 0);
    }
    function showSkipMessage(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.add('show');
      setTimeout(() => {
        el.classList.remove('show');
      }, 1000);
    }

    // Hover preview
    function startPreview(e) {
      const gridItem = e.currentTarget;
      const videoSrc = gridItem.getAttribute('data-video-src');
      if (videoSrc && !gridItem.querySelector('.preview-video')) {
        const previewEl = document.createElement('video');
        previewEl.className = 'preview-video';
        previewEl.src = videoSrc;
        previewEl.muted = true;
        previewEl.loop = true;
        previewEl.playsInline = true;
        previewEl.autoplay = true;
        gridItem.appendChild(previewEl);
        requestAnimationFrame(() => {
          previewEl.classList.add('show');
        });
      }
    }
    function stopPreview(e) {
      const gridItem = e.currentTarget;
      const previewEl = gridItem.querySelector('.preview-video');
      if (previewEl) {
        gridItem.removeChild(previewEl);
      }
    }

    /*
     =======================================
     Voice Note Players
     =======================================
    */

    // Player #1
    const audioEl1     = document.getElementById('voiceNoteAudio1');
    const timeDisplay1 = document.getElementById('timeDisplay1');
    const player1      = document.getElementById('voiceNotePlayer1');
    const playIcon1    = player1.querySelector('.icon-play');
    const pauseIcon1   = player1.querySelector('.icon-pause');
    const wave1        = document.getElementById('waveform1');

    function togglePlay1() {
      currentlyActiveItem = player1.id; 
      if (audioEl1.paused) {
        audioEl1.play();
      } else {
        audioEl1.pause();
      }
    }
    audioEl1.addEventListener('loadedmetadata', () => {
      const duration = formatTime(audioEl1.duration);
      timeDisplay1.textContent = `00:00 / ${duration}`;
    });
    audioEl1.addEventListener('play', () => {
      player1.classList.remove('paused');
      playIcon1.style.opacity  = '0';
      pauseIcon1.style.opacity = '1';
    });
    audioEl1.addEventListener('pause', () => {
      player1.classList.add('paused');
      playIcon1.style.opacity  = '1';
      pauseIcon1.style.opacity = '0';
    });
    audioEl1.addEventListener('timeupdate', () => {
      const currentTime = formatTime(audioEl1.currentTime);
      const duration    = formatTime(audioEl1.duration);
      timeDisplay1.textContent = `${currentTime} / ${duration}`;
    });
    audioEl1.addEventListener('ended', () => {
      showCompletedButton();
    });
    wave1.addEventListener('click', (e) => {
      const rect = wave1.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const fraction = clickX / rect.width;
      if (!isNaN(audioEl1.duration)) {
        audioEl1.currentTime = fraction * audioEl1.duration;
      }
    });

    // Player #2
    const audioEl2     = document.getElementById('voiceNoteAudio2');
    const timeDisplay2 = document.getElementById('timeDisplay2');
    const player2      = document.getElementById('voiceNotePlayer2');
    const playIcon2    = player2.querySelector('.icon-play');
    const pauseIcon2   = player2.querySelector('.icon-pause');
    const wave2        = document.getElementById('waveform2');

    function togglePlay2() {
      currentlyActiveItem = player2.id;
      if (audioEl2.paused) {
        audioEl2.play();
      } else {
        audioEl2.pause();
      }
    }
    audioEl2.addEventListener('loadedmetadata', () => {
      const duration = formatTime(audioEl2.duration);
      timeDisplay2.textContent = `00:00 / ${duration}`;
    });
    audioEl2.addEventListener('play', () => {
      player2.classList.remove('paused');
      playIcon2.style.opacity  = '0';
      pauseIcon2.style.opacity = '1';
    });
    audioEl2.addEventListener('pause', () => {
      player2.classList.add('paused');
      playIcon2.style.opacity  = '1';
      pauseIcon2.style.opacity = '0';
    });
    audioEl2.addEventListener('timeupdate', () => {
      const currentTime = formatTime(audioEl2.currentTime);
      const duration    = formatTime(audioEl2.duration);
      timeDisplay2.textContent = `${currentTime} / ${duration}`;
    });
    audioEl2.addEventListener('ended', () => {
      showCompletedButton();
    });
    wave2.addEventListener('click', (e) => {
      const rect = wave2.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const fraction = clickX / rect.width;
      if (!isNaN(audioEl2.duration)) {
        audioEl2.currentTime = fraction * audioEl2.duration;
      }
    });

    // Player #3
    const audioEl3     = document.getElementById('voiceNoteAudio3');
    const timeDisplay3 = document.getElementById('timeDisplay3');
    const player3      = document.getElementById('voiceNotePlayer3');
    const playIcon3    = player3.querySelector('.icon-play');
    const pauseIcon3   = player3.querySelector('.icon-pause');
    const wave3        = document.getElementById('waveform3');

    function togglePlay3() {
      currentlyActiveItem = player3.id;
      if (audioEl3.paused) {
        audioEl3.play();
      } else {
        audioEl3.pause();
      }
    }
    audioEl3.addEventListener('loadedmetadata', () => {
      const duration = formatTime(audioEl3.duration);
      timeDisplay3.textContent = `00:00 / ${duration}`;
    });
    audioEl3.addEventListener('play', () => {
      player3.classList.remove('paused');
      playIcon3.style.opacity  = '0';
      pauseIcon3.style.opacity = '1';
    });
    audioEl3.addEventListener('pause', () => {
      player3.classList.add('paused');
      playIcon3.style.opacity  = '1';
      pauseIcon3.style.opacity = '0';
    });
    audioEl3.addEventListener('timeupdate', () => {
      const currentTime = formatTime(audioEl3.currentTime);
      const duration    = formatTime(audioEl3.duration);
      timeDisplay3.textContent = `${currentTime} / ${duration}`;
    });
    audioEl3.addEventListener('ended', () => {
      showCompletedButton();
    });

    // Randomize wave bars & apply completions on load
    window.addEventListener('DOMContentLoaded', () => {
      loadCompletedItems(); 
      applyCompletedClasses(); 

      const waveforms = document.querySelectorAll('.waveform');
      waveforms.forEach(wave => {
        const bars = wave.querySelectorAll('.wave-bar');
        bars.forEach(bar => {
          const randomHeight = Math.floor(Math.random() * 31) + 10;
          bar.style.height = randomHeight + 'px';
        });
      });

      // For the double range slider
      const minRange = document.getElementById('minRange');
      const maxRange = document.getElementById('maxRange');
      const minRangeValue = document.getElementById('minRangeValue');
      const maxRangeValue = document.getElementById('maxRangeValue');
      const sliderTrack = document.getElementById('sliderTrack');

      function updateSlider() {
        let minVal = parseInt(minRange.value, 10);
        let maxVal = parseInt(maxRange.value, 10);
        // Ensure the smaller number is min, the bigger is max
        if (minVal > maxVal) {
          [minVal, maxVal] = [maxVal, minVal];
        }
        minRangeValue.textContent = minVal;
        maxRangeValue.textContent = maxVal;

        // Position the numeric bubbles
        const rangeWidth = minRange.offsetWidth; 
        const thumbPosMin = (minVal / 120) * rangeWidth;
        const thumbPosMax = (maxVal / 120) * rangeWidth;
        minRangeValue.style.left = thumbPosMin + 'px';
        maxRangeValue.style.left = thumbPosMax + 'px';

        // Highlight track
        const percentMin = (minVal / 120) * 100;
        const percentMax = (maxVal / 120) * 100;
        sliderTrack.style.left = percentMin + '%';
        sliderTrack.style.width = (percentMax - percentMin) + '%';

        applyFilters();
      }
      minRange.addEventListener('input', updateSlider);
      maxRange.addEventListener('input', updateSlider);
      updateSlider();

      // Also set up custom toggle groups for Type
      const typeButtons = document.querySelectorAll('.type-toggle-group button');
      typeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const val = btn.getAttribute('data-value');
          const radio = document.querySelector(`input[name="filterType"][value="${val}"]`);
          if (radio) {
            radio.checked = true;
            applyFilters();
          }
          typeButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      });
      typeButtons[0].classList.add('active'); // "all"

      // Orientation toggles
      const orientationButtons = document.querySelectorAll('.orientation-toggle-group button');
      orientationButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const val = btn.getAttribute('data-value');
          const radio = document.querySelector(`input[name="filterOrientation"][value="${val}"]`);
          if (radio) {
            radio.checked = true;
            applyFilters();
          }
          orientationButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      });
      orientationButtons[0].classList.add('active'); // "all"

      // ==== EXAMPLE: Data-based generation of new items (videos / audios) ====
      // (You can fill these arrays with your own data, and the items will appear automatically.)

      // 1. Data arrays
      // Just supply the minimal fields needed. For videos: { id, src, thumbnail, orientation, length }
      // For audios: { id, src, length, info (optional) }
      const remindersData = [
         {
           id: "rem1",
           src: "https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/mp4/Snapinst.app_video_AQNhVLdTAL3F4JJ7GadUOZMWhyGagXh2P0Pir8TGDGfml2hFoilAQIjCne9qftZ8DWh2BOLkR_s3rkM74iePFOZ9WbnrjzVtq_an7Fw.mp4",
           thumbnail: "https://teos-iman-hub-bucket.s3.eu-west-2.amazonaws.com/thumbnails/Screenshot+2025-02-20+110928.png",
           orientation: "portrait", // or "landscape"
           length: 2
         }
      ];

      const educationData = [
        // Example:
        // {
        //   id: "newEduVideo2",
        //   src: "https://example.com/edu/video2.mp4",
        //   thumbnail: "https://example.com/edu/thumb2.jpg",
        //   orientation: "landscape",
        //   length: 45
        // }
      ];

      const favRecitationsAudio = [
        // Example:
        // {
        //   id: "myNewRecitation1",
        //   src: "https://example.com/audio1.mp3",
        //   length: 5,
        //   info: "Surah 99, Az-Zalzalah"
        // }
      ];

      const salahRecordingsAudio = [
        // Example:
        // {
        //   id: "myNewSalahAudio1",
        //   src: "https://example.com/salahAudio1.mp3",
        //   length: 4,
        //   info: "Sheikh So-and-so"
        // }
      ];

      // 2. Functions to create the HTML automatically

      // For new videos
      function createVideoGridItem(item) {
        const div = document.createElement('div');
        div.classList.add('grid-item');
        // data attributes for filters + completed checks
        div.setAttribute('data-video-id', item.id);
        div.setAttribute('data-video-src', item.src);
        div.setAttribute('data-type', 'video');
        div.setAttribute('data-orientation', item.orientation || 'portrait');
        div.setAttribute('data-length', item.length || '1');

        // styling
        div.style.backgroundImage = `url('${item.thumbnail}')`;

        // event handlers
        div.onclick = () => openOverlay(item.id, item.src);
        div.onmouseover = startPreview;
        div.onmouseleave = stopPreview;

        return div;
      }

      // For new audios
      function createAudioPlayer(item) {
        // We'll build a voice-note-container + voice-note-player structure
        const container = document.createElement('div');
        container.classList.add('voice-note-container');

        // The player block
        const player = document.createElement('div');
        player.classList.add('voice-note-player', 'paused');
        player.id = item.id;
        player.dataset.type = "audio";
        player.dataset.orientation = "none";
        player.dataset.length = item.length || "0";

        // Build waveform bars
        let barsHTML = '';
        for (let i=1; i<=90; i++){
          barsHTML += `<div class="wave-bar" style="--i:${i}"></div>`;
        }

        // Use item.info if provided
        const infoText = item.info ? item.info : "";

        // Insert the inner HTML
        player.innerHTML = `
          <div class="player-top-row">
            <div class="play-pause-btn" onclick="togglePlayGeneric('${item.id}')">
              <svg class="icon icon-play" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"></path>
              </svg>
              <svg class="icon icon-pause" viewBox="0 0 24 24">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
              </svg>
            </div>
            <div class="waveform" id="waveform_${item.id}">
              ${barsHTML}
            </div>
            <div class="time-display" id="timeDisplay_${item.id}">00:00 / 00:00</div>
          </div>
          <div class="recording-info">${infoText}</div>
          <audio id="audio_${item.id}" src="${item.src}"></audio>
        `;

        // append
        container.appendChild(player);
        return container;
      }

      // 3. We add them to the page in the correct place
      // For Reminders
      const remindersGridExtra = document.getElementById('remindersGridExtra');
      remindersData.forEach(item => {
        const gridItem = createVideoGridItem(item);
        remindersGridExtra.appendChild(gridItem);
      });

      // For Education
      const educationGridExtra = document.getElementById('educationGridExtra');
      educationData.forEach(item => {
        const gridItem = createVideoGridItem(item);
        educationGridExtra.appendChild(gridItem);
      });

      // For Fav Recitations
      const favRecitationsExtra = document.getElementById('favRecitationsExtra');
      favRecitationsAudio.forEach(item => {
        const audioElem = createAudioPlayer(item);
        favRecitationsExtra.appendChild(audioElem);
        // randomize wavebars
        const waveContainer = audioElem.querySelector(`#waveform_${item.id}`);
        const bars = waveContainer.querySelectorAll('.wave-bar');
        bars.forEach(bar => {
          const randomHeight = Math.floor(Math.random() * 31) + 10;
          bar.style.height = randomHeight + 'px';
        });
      });

      // For Salah Recordings
      const salahRecordingsExtra = document.getElementById('salahRecordingsExtra');
      salahRecordingsAudio.forEach(item => {
        const audioElem = createAudioPlayer(item);
        salahRecordingsExtra.appendChild(audioElem);
        // randomize wavebars
        const waveContainer = audioElem.querySelector(`#waveform_${item.id}`);
        const bars = waveContainer.querySelectorAll('.wave-bar');
        bars.forEach(bar => {
          const randomHeight = Math.floor(Math.random() * 31) + 10;
          bar.style.height = randomHeight + 'px';
        });
      });

      // 4. Generic togglePlay function for new audio
      // (We will mimic your existing togglePlay1/togglePlay2 structure, but handle ID dynamically.)
      window.togglePlayGeneric = function (playerId) {
        currentlyActiveItem = playerId;
        const playerDiv = document.getElementById(playerId);
        if (!playerDiv) return;
        const audioEl = document.getElementById(`audio_${playerId}`);
        if (!audioEl) return;

        if (audioEl.paused) {
          audioEl.play();
        } else {
          audioEl.pause();
        }

        // we can do the same event listeners for loadedmetadata, timeupdate, etc. dynamically
        // or handle them once below:
        audioEl.addEventListener('loadedmetadata', () => {
          const dur = formatTime(audioEl.duration);
          const timeDisplay = document.getElementById(`timeDisplay_${playerId}`);
          if (timeDisplay) {
            timeDisplay.textContent = `00:00 / ${dur}`;
          }
        });
        audioEl.addEventListener('play', () => {
          playerDiv.classList.remove('paused');
          const pIcon = playerDiv.querySelector('.icon-play');
          const sIcon = playerDiv.querySelector('.icon-pause');
          if (pIcon) pIcon.style.opacity = '0';
          if (sIcon) sIcon.style.opacity = '1';
        });
        audioEl.addEventListener('pause', () => {
          playerDiv.classList.add('paused');
          const pIcon = playerDiv.querySelector('.icon-play');
          const sIcon = playerDiv.querySelector('.icon-pause');
          if (pIcon) pIcon.style.opacity = '1';
          if (sIcon) sIcon.style.opacity = '0';
        });
        audioEl.addEventListener('timeupdate', () => {
          const cur = formatTime(audioEl.currentTime);
          const dur = formatTime(audioEl.duration);
          const timeDisplay = document.getElementById(`timeDisplay_${playerId}`);
          if (timeDisplay) {
            timeDisplay.textContent = `${cur} / ${dur}`;
          }
        });
        audioEl.addEventListener('ended', () => {
          showCompletedButton();
        });

        // If user clicks the waveform, scrub:
        const waveDiv = document.getElementById(`waveform_${playerId}`);
        if (waveDiv) {
          waveDiv.onclick = (e) => {
            const rect = waveDiv.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const fraction = clickX / rect.width;
            if (!isNaN(audioEl.duration)) {
              audioEl.currentTime = fraction * audioEl.duration;
            }
          };
        }
      };

      // Re-apply filters so newly created items obey the filter
      applyFilters();
    });

    // Filter logic
    function applyFilters() {
      const typeValue = document.querySelector('input[name="filterType"]:checked').value;
      const orientationValue = document.querySelector('input[name="filterOrientation"]:checked').value;
      const minVal = parseInt(document.getElementById('minRange').value, 10);
      const maxVal = parseInt(document.getElementById('maxRange').value, 10);
      const rangeMin = Math.min(minVal, maxVal);
      const rangeMax = Math.max(minVal, maxVal);

      const activeContent = document.querySelector('.content.active');
      if (!activeContent) return;

      const items = activeContent.querySelectorAll('.grid-item, .voice-note-player');
      items.forEach(item => {
        const dataType = item.getAttribute('data-type') || 'video';
        const dataOrientation = item.getAttribute('data-orientation') || 'none';
        const dataLength = parseInt(item.getAttribute('data-length') || '0', 10);

        const passType = (typeValue === 'all' || typeValue === dataType);
        const passOrientation = (orientationValue === 'all' || orientationValue === dataOrientation);
        const passLength = (dataLength >= rangeMin && dataLength <= rangeMax);

        if (passType && passOrientation && passLength) {
          item.style.display = '';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // Listen for Escape key to close
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && document.getElementById('videoOverlay').classList.contains('active')) {
        closeOverlay();
      }
    });
  </script>
</body>
</html>
