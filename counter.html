<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vivid Counter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#3b82f6" />
  <style>
    :root{
      --safe-bottom: env(safe-area-inset-bottom, 16px);
      --safe-top: env(safe-area-inset-top, 0px);
      --text: rgba(255,255,255,.92);
      --btn-bg: rgba(255,255,255,.18);
      --btn-bg-hover: rgba(255,255,255,.28);
      --btn-border: rgba(255,255,255,.45);
      --sheet-bg: rgba(28,28,30,.98);
      --divider: rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --anim-ms: 420ms;
      --bg-fade: 650ms;
    }

    html, body{
      height:100%;
      margin:0;
      -webkit-tap-highlight-color: transparent;
      background: #0f172a;
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol";
      color: var(--text);
      overflow: hidden;
    }

    /* ===== MAIN CANVAS ===== */
    .app{
      position:relative;
      height:100%;
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      cursor: default;
      isolation:isolate;
      background:#111827; /* fallback behind layers */
    }

    /* Gradient cross-fade layers (fixes “hard cut” & makes fully smooth) */
    .bg-layer{
      position:absolute; inset:0;
      transition: opacity var(--bg-fade) ease;
      opacity:0;
      z-index:0;
    }
    .bg-layer.show{ opacity:1; }

    /* subtle diagonal texture like in screenshots */
    .texture{
      position:absolute; inset:0; z-index:2;
      background:
        linear-gradient(115deg, rgba(255,255,255,.04), rgba(255,255,255,0) 30%, rgba(0,0,0,0) 70%, rgba(0,0,0,.08)),
        repeating-linear-gradient(120deg, rgba(255,255,255,.06) 0 1px, transparent 1px 12px);
      mix-blend-mode: soft-light;
      pointer-events:none;
    }

    /* number holder */
    .number-wrap{
      position:relative;
      line-height:1;
      z-index:3;
    }

    /* We keep .prev in DOM for structure parity, but it’s never shown now */
    .prev{ display:none !important; }

    .current{
      position:relative;
      font-weight:300;
    }

    /* auto-resize number using vw while clamping */
    .num{
      font-size: clamp(64px, 18vw, 160px);
      letter-spacing: 2px;
      color: var(--text);
      text-shadow: 0 2px 16px rgba(0,0,0,.25);
      will-change: transform, opacity;
    }

    /* Smooth number transition (no ghosting of previous digit) */
    @keyframes numFadeScale {
      0%   { opacity: 0; transform: translateY(6px) scale(0.96); filter: blur(.3px); }
      100% { opacity: 1; transform: translateY(0)   scale(1);    filter: blur(0); }
    }
    .pulse{
      animation: numFadeScale var(--anim-ms) cubic-bezier(.22,.61,.36,1);
    }

    /* ===== BOTTOM BUTTONS ===== */
    .controls{
      position:fixed; left:16px; right:16px; bottom: calc(12px + var(--safe-bottom));
      display:flex; align-items:center; justify-content:space-between;
      pointer-events:none; /* allow page taps to pass through except on buttons */
      z-index:4;
    }
    .left-group{ display:flex; gap:12px; }
    .btn{
      pointer-events:auto;
      width:42px; height:42px; border-radius:50%;
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      display:grid; place-items:center;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      box-shadow: var(--shadow);
      transition: background .2s ease, transform .08s ease;
    }
    .btn:active{ transform: scale(.96); }
    .btn:hover{ background: var(--btn-bg-hover); }

    /* icons */
    .icon-ring{
      width:16px; height:16px; border-radius:50%;
      border:2px solid #fff;
      opacity:.92;
    }
    .icon-minus{
      width:18px; height:2px; background:#fff; border-radius:2px; opacity:.92;
    }
    .icon-i{
      width:14px; height:14px; border-radius:50%;
      border:2px solid #fff; position:relative;
      opacity:.92;
    }
    .icon-i::after{
      content:""; position:absolute; left:50%; transform:translateX(-50%);
      top:2px; width:2px; height:2px; background:#fff; border-radius:1px;
    }
    .icon-i::before{
      content:""; position:absolute; left:50%; transform:translateX(-50%);
      top:6px; width:2px; height:6px; background:#fff; border-radius:1px;
    }

    /* ===== TOP-RIGHT FULLSCREEN BUTTON ===== */
    .top-controls{
      position:fixed;
      top: calc(12px + var(--safe-top));
      right:16px;
      display:flex; gap:12px;
      pointer-events:none;
      z-index:4;
    }
    .icon-glyph{
      font-size:16px; line-height:16px; font-weight:700; opacity:.92;
      color:#fff; transform: translateY(-1px);
    }

    /* ===== ACTION SHEET (Reset) ===== */
    .sheet-wrap{
      position:fixed; inset:0; display:none; align-items:flex-end; justify-content:center;
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(1px);
      -webkit-backdrop-filter: blur(1px);
      z-index:30;
    }
    .sheet-wrap.active{ display:flex; }
    .sheet{
      width:100%; max-width:520px; margin:0 8px 8px; border-radius:18px; overflow:hidden;
      background: var(--sheet-bg); box-shadow: var(--shadow);
      transform: translateY(30px); opacity:0; transition: transform .18s ease, opacity .18s ease;
    }
    .sheet-wrap.active .sheet{ transform: translateY(0); opacity:1; }
    .sheet .action{ padding:16px; text-align:center; font-size:18px; }
    .sheet .action.reset{ color:#ff453a; font-weight:600; border-bottom:1px solid var(--divider);}
    .sheet .action.cancel{ color:#0a84ff; font-weight:600; }

    /* ===== SETTINGS PANEL ===== */
    .panel{
      position:fixed; inset:0; background: #f2f2f7; color:#000; display:none; flex-direction:column; z-index:40;
    }
    .panel.active{ display:flex; }
    .panel .nav{
      padding-top: calc(6px + var(--safe-top));
      height:56px; display:flex; align-items:center; justify-content:center; position:relative;
      background:#fff; border-bottom:1px solid #e5e5ea;
      font-weight:600;
    }
    .panel .done{
      position:absolute; right:12px; top: calc(8px + var(--safe-top));
      padding:6px 10px; color:#0a84ff; font-weight:600; border-radius:10px;
    }
    .section-title{
      padding:14px 16px 6px; font-size:12px; color:#6e6e73;
      text-transform:uppercase; letter-spacing:.02em; font-weight:700;
    }
    .list{
      background:#fff; border-top:1px solid #e5e5ea; border-bottom:1px solid #e5e5ea;
    }
    .row{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px; border-bottom:1px solid #e5e5ea; font-size:16px;
    }
    .row:last-child{ border-bottom:none; }
    .value{ color:#8e8e93; }
    .chev{ margin-left:6px; color:#c7c7cc; }
    .switch{
      --w: 51px; --h:31px;
      position:relative; width:var(--w); height:var(--h);
    }
    .switch input{ display:none; }
    .slider{
      position:absolute; inset:0; background:#e9e9ea; border-radius:999px; transition: background .15s ease;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.05);
    }
    .slider::before{
      content:""; position:absolute; width:27px; height:27px; top:2px; left:2px; background:#fff; border-radius:50%;
      box-shadow: 0 2px 6px rgba(0,0,0,.18); transition: transform .15s ease;
    }
    .switch input:checked + .slider{ background:#34c759; }
    .switch input:checked + .slider::before{ transform: translateX(20px); }

    .panel small.mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color:#6e6e73;
    }

    /* SOUND SUBPANEL */
    .subpanel{
      position:absolute; inset:0; background:#f2f2f7; display:none; flex-direction:column;
      transition: transform .2s ease;
    }
    .subpanel.active{ display:flex; }
    .option{ padding:14px 16px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #e5e5ea; background:#fff; }
    .check{ width:20px; height:20px; border-radius:50%; border:2px solid #0a84ff; display:grid; place-items:center; }
    .check .dot{ width:10px; height:10px; border-radius:50%; background:#0a84ff; display:none; }
    .option.active .dot{ display:block; }
    .back{
      position:absolute; left:12px; top: calc(8px + var(--safe-top));
      padding:6px 10px; color:#0a84ff; font-weight:600; border-radius:10px;
    }

    /* responsive corrections */
    @media (min-width:768px){
      .btn{ width:48px; height:48px; }
      .num{ font-size: clamp(80px, 12vw, 180px); }
    }
  </style>
</head>
<body>

  <!-- MAIN TAP AREA -->
  <div id="app" class="app">
    <!-- gradient layers for buttery-smooth fades -->
    <div id="bgA" class="bg-layer show"></div>
    <div id="bgB" class="bg-layer"></div>

    <div class="texture"></div>

    <div id="numberWrap" class="number-wrap">
      <div id="prev" class="num prev">0</div>
      <div id="current" class="num current">0</div>
    </div>

    <!-- Top-right controls -->
    <div class="top-controls">
      <button id="fullscreen" class="btn" aria-label="Full Screen" aria-pressed="false" title="Full Screen">
        <div class="icon-glyph" aria-hidden="true">⛶</div>
      </button>
    </div>

    <!-- Bottom controls -->
    <div class="controls">
      <div class="left-group">
        <button id="resetOpen" class="btn" aria-label="Reset">
          <div class="icon-ring" aria-hidden="true"></div>
        </button>
        <button id="minus" class="btn" aria-label="Decrement">
          <div class="icon-minus" aria-hidden="true"></div>
        </button>
      </div>
      <button id="info" class="btn" aria-label="Settings">
        <div class="icon-i" aria-hidden="true"></div>
      </button>
    </div>
  </div>

  <!-- Action Sheet: Reset -->
  <div id="sheetWrap" class="sheet-wrap" role="dialog" aria-modal="true" aria-label="Reset Counter">
    <div class="sheet" style="max-width:520px;">
      <div id="doReset" class="action reset">Reset</div>
      <div id="cancelReset" class="action cancel">Cancel</div>
    </div>
  </div>

  <!-- SETTINGS PANEL -->
  <div id="panel" class="panel" role="dialog" aria-modal="true" aria-label="Settings">
    <div class="nav">Vivid Counter <button id="done" class="done">Done</button></div>

    <div class="section-title">Settings</div>
    <div class="list">
      <div class="row" id="soundRow" role="button" tabindex="0" aria-haspopup="true" aria-controls="soundPanel">
        <div>Sound</div>
        <div><span id="soundLabel" class="value">Haptic Feedback</span><span class="chev">›</span></div>
      </div>

      <div class="row">
        <div>Color Change</div>
        <label class="switch">
          <input id="toggleColor" type="checkbox" checked />
          <span class="slider"></span>
        </label>
      </div>

      <div class="row">
        <div>Text Animation</div>
        <label class="switch">
          <input id="toggleAnim" type="checkbox" checked />
          <span class="slider"></span>
        </label>
      </div>
    </div>

    <div class="section-title">Device</div>
    <div class="list">
      <div class="row">
        <div>Disable Auto-Lock</div>
        <label class="switch">
          <input id="toggleWake" type="checkbox" />
          <span class="slider"></span>
        </label>
      </div>
    </div>

    <div class="section-title">Information</div>
    <div class="list">
      <div class="row">
        <div>Version</div>
        <div class="value">4.1 (11)</div>
      </div>
    </div>

    <!-- Sound subpanel -->
    <div id="soundPanel" class="subpanel" aria-label="Sound">
      <div class="nav">Sound
        <button id="backFromSound" class="back">Back</button>
        <button id="doneFromSound" class="done">Done</button>
      </div>
      <div class="section-title">Feedback Type</div>
      <div class="list">
        <div class="option" data-sound="none">
          <div>None</div>
          <div class="check"><div class="dot"></div></div>
        </div>
        <div class="option" data-sound="haptic">
          <div>Haptic Feedback</div>
          <div class="check"><div class="dot"></div></div>
        </div>
        <div class="option" data-sound="click">
          <div>Click Sound</div>
          <div class="check"><div class="dot"></div></div>
        </div>
      </div>
      <div style="padding:14px 16px; color:#6e6e73;">
        <small class="mono">Haptics use the Vibration API when available. “Click Sound” uses WebAudio; device volume applies.</small>
      </div>
    </div>
  </div>

  <script>
    /* =======================
       STATE & PERSISTENCE
    ======================= */
    const $ = (s, r=document) => r.querySelector(s);
    const app = $('#app');
    const prevEl = $('#prev');
    const currentEl = $('#current');
    const numberWrap = $('#numberWrap');

    const sheetWrap = $('#sheetWrap');
    const resetOpen = $('#resetOpen');
    const minusBtn = $('#minus');
    const infoBtn = $('#info');
    const doReset = $('#doReset');
    const cancelReset = $('#cancelReset');

    const panel = $('#panel');
    const doneBtn = $('#done');

    const soundRow = $('#soundRow');
    const soundPanel = $('#soundPanel');
    const backFromSound = $('#backFromSound');
    const doneFromSound = $('#doneFromSound');
    const soundLabel = $('#soundLabel');

    const toggleColor = $('#toggleColor');
    const toggleAnim = $('#toggleAnim');
    const toggleWake = $('#toggleWake');

    const bgA = $('#bgA');
    const bgB = $('#bgB');

    /* Fullscreen button */
    const fullscreenBtn = $('#fullscreen');

    let activeBg = 'A'; // which layer currently shown

    let value = 0;
    let settings = {
      colorChange: true,
      textAnim: true,
      sound: 'haptic', // 'none' | 'haptic' | 'click'
      wakeLock: false,
      themeIndex: 0
    };

    const LS_KEY_VAL = 'vividCounter.value';
    const LS_KEY_SET = 'vividCounter.settings';

    try{
      const savedV = localStorage.getItem(LS_KEY_VAL);
      const savedS = localStorage.getItem(LS_KEY_SET);
      if(savedV !== null) value = parseInt(savedV,10);
      if(savedS) settings = { ...settings, ...JSON.parse(savedS) };
    }catch(e){ /* ignore */ }

    /* =======================
       BACKGROUNDS (smooth)
    ======================= */
    const themes = [
      { bg: 'linear-gradient(135deg,#b993d6 0%,#8ca6db 100%)' },                // lilac → periwinkle
      { bg: 'linear-gradient(135deg,#0f2027 0%,#203a43 50%,#2c5364 100%)' },    // deep blue
      { bg: 'linear-gradient(135deg,#a18cd1 0%,#fbc2eb 20%,#a1ffce 40%,#faffd1 60%,#fbc2eb 80%,#a1c4fd 100%)' }, // rainbow
      { bg: 'linear-gradient(135deg,#a8e063 0%,#56ab2f 40%,#2f80ed 100%)' },    // lime → sky
      { bg: 'linear-gradient(135deg,#667eea 0%,#764ba2 100%)' },
      { bg: 'linear-gradient(135deg,#ff9966 0%,#ff5e62 100%)' },
      { bg: 'linear-gradient(135deg,#00c6ff 0%,#0072ff 100%)' },
      { bg: 'linear-gradient(135deg,#36d1dc 0%,#5b86e5 100%)' },
      { bg: 'linear-gradient(135deg,#fbd3e9 0%,#bb377d 100%)' },
      { bg: 'linear-gradient(135deg,#11998e 0%,#38ef7d 100%)' }
    ];
    function setLayerBG(layer, css){
      layer.style.backgroundImage = css;
    }
    // crossfade to next theme smoothly (no jump)
    function applyTheme(index, animate=true){
      const css = themes[index % themes.length].bg;
      const showA = (activeBg === 'A');
      const front = showA ? bgA : bgB;   // currently visible
      const back  = showA ? bgB : bgA;   // will fade up

      setLayerBG(back, css);
      if(animate){
        back.classList.add('show');
        front.classList.remove('show');
      }else{
        back.classList.add('show');
        front.classList.remove('show');
      }
      activeBg = showA ? 'B' : 'A';
    }

    /* =======================
       AUDIO (click sound)
    ======================= */
    let audioCtx = null;
    function playClick(){
      try{
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const t = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.setValueAtTime(660, t);
        gain.gain.setValueAtTime(0.0001, t);
        gain.gain.exponentialRampToValueAtTime(0.12, t + 0.005);
        gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.06);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start(t);
        osc.stop(t + 0.08);
      }catch(e){ /* ignore */ }
    }

    function haptic(){
      if(navigator.vibrate){
        navigator.vibrate(20);
      }
    }

    function feedback(){
      if(settings.sound === 'click') playClick();
      else if(settings.sound === 'haptic') haptic();
    }

    /* =======================
       WAKE LOCK (Auto-Lock)
    ======================= */
    let wakeLock = null;
    async function requestWake(){
      if(!('wakeLock' in navigator)) return;
      try{
        wakeLock = await navigator.wakeLock.request('screen');
        wakeLock.addEventListener('release', ()=>{ /* released */ });
      }catch(e){ /* permission or unsupported */ }
    }
    async function releaseWake(){
      try{
        if(wakeLock){ await wakeLock.release(); wakeLock = null; }
      }catch(e){}
    }
    document.addEventListener('visibilitychange', async ()=>{
      if(document.visibilityState === 'visible' && settings.wakeLock) requestWake();
    });

    /* =======================
       FULLSCREEN (Top-right toggle)
    ======================= */
    function fsElement(){
      return document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement;
    }
    async function enterFullscreen(){
      const el = document.documentElement;
      try{
        if(el.requestFullscreen) await el.requestFullscreen();
        else if(el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
        else if(el.msRequestFullscreen) await el.msRequestFullscreen();
      }catch(e){ /* ignore */ }
    }
    async function exitFullscreen(){
      try{
        if(document.exitFullscreen) await document.exitFullscreen();
        else if(document.webkitExitFullscreen) await document.webkitExitFullscreen();
        else if(document.msExitFullscreen) await document.msExitFullscreen();
      }catch(e){ /* ignore */ }
    }
    function updateFSUI(){
      const on = !!fsElement();
      fullscreenBtn.setAttribute('aria-pressed', on ? 'true' : 'false');
      fullscreenBtn.setAttribute('aria-label', on ? 'Exit Full Screen' : 'Full Screen');
      fullscreenBtn.title = on ? 'Exit Full Screen' : 'Full Screen';
    }
    function toggleFullscreen(){
      if(fsElement()) exitFullscreen(); else enterFullscreen();
    }
    fullscreenBtn.addEventListener('click', (e)=>{ e.stopPropagation(); toggleFullscreen(); }, {passive:true});
    document.addEventListener('fullscreenchange', updateFSUI);
    document.addEventListener('webkitfullscreenchange', updateFSUI);
    document.addEventListener('msfullscreenchange', updateFSUI);

    /* =======================
       RENDER / UPDATE
       (No ghost previous number; single element with re-triggered animation)
    ======================= */
    function animateNumber(){
      if(!settings.textAnim) return;
      currentEl.classList.remove('pulse'); // restart animation
      // force reflow to re-trigger CSS animation reliably
      // eslint-disable-next-line no-unused-expressions
      currentEl.offsetWidth;
      currentEl.classList.add('pulse');
    }

    function updateNumberDisplay(newVal, fromTap = false){
      // show only current number; previous is never visible (bug fixed)
      currentEl.textContent = String(newVal);
      animateNumber();

      if(settings.colorChange && fromTap){
        settings.themeIndex = (settings.themeIndex + 1) % themes.length;
        applyTheme(settings.themeIndex, true);
      }
      if(fromTap) feedback();

      try{
        localStorage.setItem(LS_KEY_VAL, String(value));
        localStorage.setItem(LS_KEY_SET, JSON.stringify(settings));
      }catch(e){}
    }

    /* =======================
       INIT UI FROM STATE
    ======================= */
    currentEl.textContent = String(value);
    toggleColor.checked = !!settings.colorChange;
    toggleAnim.checked = !!settings.textAnim;
    toggleWake.checked = !!settings.wakeLock;
    // initialize both layers so first paint is correct (no flash)
    setLayerBG(bgA, themes[settings.themeIndex].bg);
    setLayerBG(bgB, themes[(settings.themeIndex+1)%themes.length].bg);
    bgA.classList.add('show'); bgB.classList.remove('show');
    soundLabel.textContent = settings.sound === 'click' ? 'Click Sound' :
                             settings.sound === 'none' ? 'None' : 'Haptic Feedback';
    updateFSUI();

    /* =======================
       INTERACTION (TAPS)
    ======================= */
    function increment(){
      value += 1;
      updateNumberDisplay(value, true);
    }
    function decrement(){
      value -= 1;
      updateNumberDisplay(value, true);
    }
    function reset(){
      value = 0;
      updateNumberDisplay(value, true);
    }

    // Tap anywhere to increment (but not on buttons/overlays)
    function isInteractiveTarget(e){
      const t = e.target;
      return t.closest('.btn') || t.closest('.sheet-wrap') || t.closest('.panel');
    }
    app.addEventListener('click', (e)=>{
      if(isInteractiveTarget(e)) return;
      increment();
    }, {passive:true});

    // Buttons
    minusBtn.addEventListener('click', (e)=>{ e.stopPropagation(); decrement(); });
    resetOpen.addEventListener('click', (e)=>{ e.stopPropagation(); sheetWrap.classList.add('active'); });
    cancelReset.addEventListener('click', ()=> sheetWrap.classList.remove('active'));
    doReset.addEventListener('click', ()=>{ sheetWrap.classList.remove('active'); reset(); });
    sheetWrap.addEventListener('click', (e)=>{ if(e.target === sheetWrap) sheetWrap.classList.remove('active'); });

    infoBtn.addEventListener('click', (e)=>{ e.stopPropagation(); openPanel(); });

    function openPanel(){ panel.classList.add('active'); }
    function closePanel(){ panel.classList.remove('active'); }
    doneBtn.addEventListener('click', closePanel);

    // Settings toggles
    toggleColor.addEventListener('change', ()=>{
      settings.colorChange = toggleColor.checked;
      try{ localStorage.setItem(LS_KEY_SET, JSON.stringify(settings)); }catch(e){}
    });
    toggleAnim.addEventListener('change', ()=>{
      settings.textAnim = toggleAnim.checked;
      if(!settings.textAnim) currentEl.classList.remove('pulse');
      try{ localStorage.setItem(LS_KEY_SET, JSON.stringify(settings)); }catch(e){}
    });
    toggleWake.addEventListener('change', async ()=>{
      settings.wakeLock = toggleWake.checked;
      if(settings.wakeLock) await requestWake(); else await releaseWake();
      try{ localStorage.setItem(LS_KEY_SET, JSON.stringify(settings)); }catch(e){}
    });

    // Sound subpanel
    soundRow.addEventListener('click', ()=> soundPanel.classList.add('active'));
    soundRow.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); soundPanel.classList.add('active'); }});
    function selectSound(kind){
      settings.sound = kind;
      soundLabel.textContent = kind === 'click' ? 'Click Sound' :
                               kind === 'none' ? 'None' : 'Haptic Feedback';
      [...soundPanel.querySelectorAll('.option')].forEach(o=>{
        o.classList.toggle('active', o.dataset.sound === kind);
      });
      try{ localStorage.setItem(LS_KEY_SET, JSON.stringify(settings)); }catch(e){}
    }
    soundPanel.querySelectorAll('.option').forEach(opt=>{
      opt.addEventListener('click', ()=> selectSound(opt.dataset.sound));
    });
    backFromSound.addEventListener('click', ()=> soundPanel.classList.remove('active'));
    doneFromSound.addEventListener('click', ()=> soundPanel.classList.remove('active'));
    // initialize selected dot
    selectSound(settings.sound);

    // Keyboard support (optional parity)
    window.addEventListener('keydown', (e)=>{
      if(panel.classList.contains('active')) return;
      if(e.key === ' ' || e.key === 'Enter') increment();
      if(e.key === '-') decrement();
      if(e.key === '0') reset();
    });

    // Prevent accidental text selection / dragging
    document.addEventListener('gesturestart', e => e.preventDefault());
  </script>
</body>
</html>
