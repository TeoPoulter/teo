<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>The Clear Qur’an — Mustafa Khattab (English) — teos.tools</title>
  <meta name="description" content="Browse all 114 sūrahs and read The Clear Qur’an translation by Dr. Mustafa Khattab (English). Clean, fast image-based reader with full-screen, swipe, and keyboard navigation." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://teostoolsquran.s3.eu-west-2.amazonaws.com" crossorigin>

  <style>
    /* --- LIGHT THEME (default) --- */
    :root{
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #0f1115;
      --muted: #5e6472;
      --border: #e7e8ee;
      --accent: #b49f5e;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius: 18px;
      --maxw: 1200px;
      --gap: clamp(14px, 2.4vw, 22px);
      --readerMax: 1100px;
      --slide-distance: 28px;
      --slide-duration: 220ms;
      --slide-ease: cubic-bezier(.22,.61,.36,1);
      --backdrop-grad: radial-gradient(1200px 800px at 15% -10%, rgba(180,159,94,.10), transparent 60%);
      --hero-grad: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.72));
      --panel-grad: linear-gradient(180deg, #ffffff, #fbfbfe);
      --panel-grad-hover: linear-gradient(180deg, #ffffff, #f8f9fd);
      --arrow: #3b404d;
      --page-bg: #000; /* neutral surround behind PNG edges */
    }
    /* --- DARK THEME OVERRIDES --- */
    body.dark{
      --bg: #0e1116;
      --card: #151924;
      --text: #e9ecf3;
      --muted: #a9b0c3;
      --border: #242938;
      --accent: #cdb66a;
      --shadow: 0 10px 30px rgba(0,0,0,.4);
      --backdrop-grad: radial-gradient(1200px 800px at 15% -10%, rgba(205,182,106,.10), transparent 60%),
                       radial-gradient(1000px 700px at 110% -20%, rgba(103,119,239,.08), transparent 60%);
      --hero-grad: linear-gradient(180deg, rgba(30,35,48,.85), rgba(30,35,48,.72));
      --panel-grad: linear-gradient(180deg, #171b26, #141826);
      --panel-grad-hover: linear-gradient(180deg, #181d29, #151a28);
      --arrow: #c8d0e5;
      --page-bg: #111; /* surround in reader (not fullscreen) */
    }

    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      font-family:'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: var(--backdrop-grad), var(--bg);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a, button{ -webkit-tap-highlight-color: transparent; }

    .wrap{ max-width: var(--maxw); margin:0 auto; padding: clamp(16px,3vw,28px); }
    .panel{
      margin-top: clamp(16px, 2.6vw, 24px);
      padding: clamp(14px, 2.2vw, 20px);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .visually-hidden{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
    svg{ display:block }

    /* HERO */
    header.hero{
      display:flex; flex-direction:column; gap: 12px;
      padding: clamp(18px,3vw,26px);
      background: var(--hero-grad);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative; overflow:hidden; isolation:isolate;
    }
    header.hero::after{
      content:""; position:absolute; inset:-100% -40%;
      background: radial-gradient(60% 20% at 50% 0%, rgba(180,159,94,.18), transparent 60%);
      transform: translateY(0); animation: floatGlow 9s ease-in-out infinite;
      pointer-events:none; z-index:-1; opacity: .75;
    }
    @keyframes floatGlow{ 0%,100%{ transform:translateY(0); opacity:.7 } 50%{ transform:translateY(12%); opacity:.45 } }
    h1{
      margin:0; font-weight:600; letter-spacing:.2px; line-height:1.15; font-size: clamp(28px, 4vw, 44px);
      background: linear-gradient(90deg, var(--text), var(--arrow) 40%, var(--text) 80%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .subtitle{
      margin:2px 0 4px; font-size: clamp(14px, 1.7vw, 16.5px); line-height: 1.75; color: var(--muted);
    }

    /* SURAH GRID */
    .grid{
      display:grid; grid-template-columns: repeat(1, minmax(0, 1fr)); gap: var(--gap);
    }
    @media (min-width:520px){ .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (min-width:820px){ .grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); } }
    @media (min-width:1100px){ .grid{ grid-template-columns: repeat(4, minmax(0, 1fr)); } }

    .surah{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 14px 16px; border-radius: 14px;
      border:1px solid var(--border); background: var(--panel-grad);
      text-decoration:none; color:var(--text);
      transition: transform .18s ease, border-color .18s ease, box-shadow .2s ease, background .25s ease;
      will-change: transform;
    }
    .surah:hover{
      transform: translateY(-2px);
      border-color: rgba(180,159,94,.55);
      box-shadow: 0 10px 26px rgba(0,0,0,.08);
      background: var(--panel-grad-hover);
    }
    .surah:focus-visible{ outline:2px solid var(--accent); outline-offset: 2px; }
    .badge{
      font-weight:600; font-size:12px; letter-spacing:.35px; text-transform:uppercase;
      padding:6px 9px; border-radius:999px; border:1px solid rgba(180,159,94,.55);
      background: radial-gradient(120% 100% at 10% 0%, rgba(180,159,94,.18), transparent 60%);
      color:#6f6136; flex:0 0 auto;
    }
    body.dark .badge{ color:#e7d99c; border-color: rgba(205,182,106,.55); }
    .meta{ display:flex; align-items:center; gap:10px; min-width:0; }
    .num{ font-weight:600; color:var(--text); opacity:.9; flex:0 0 auto; }
    .name{ font-weight:500; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:var(--text); }
    .arrow{ color:var(--arrow); opacity:.6; transition: transform .18s ease, opacity .18s ease; flex:0 0 auto; }
    .surah:hover .arrow{ transform:translateX(3px); opacity:1; }

    /* READER */
    .page-head{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      padding: clamp(10px,1.8vw,14px);
      background: var(--panel-grad);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin: clamp(16px, 2.6vw, 24px) auto 0;
      max-width: var(--maxw);
    }
    .title-group{ display:flex; flex-direction:column; gap:2px; min-width: 0; }
    .readerTitle{ font-weight:600; letter-spacing:.2px; font-size: clamp(18px, 2.5vw, 22px); }
    .readerSub{ color: var(--muted); font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      height: 40px; padding: 0 12px; border-radius: 12px;
      border:1px solid var(--border); background: var(--card); color: var(--text);
      text-decoration:none; cursor:pointer; transition: transform .15s ease, border-color .15s ease, box-shadow .2s ease;
    }
    .btn:hover{ transform:translateY(-1px); border-color: rgba(180,159,94,.55); box-shadow: 0 10px 26px rgba(0,0,0,.08) }
    .btn:focus-visible{ outline:2px solid var(--accent); outline-offset:2px }
    .chip{
      font-weight:600; font-size:12px; letter-spacing:.35px; text-transform:uppercase;
      padding:6px 9px; border-radius:999px; border:1px solid rgba(180,159,94,.55);
      background: radial-gradient(120% 100% at 10% 0%, rgba(180,159,94,.18), transparent 60%);
      color:#6f6136;
    }
    body.dark .chip{ color:#e7d99c; border-color: rgba(205,182,106,.55); }

    .readerBody{
      padding: clamp(10px, 2vw, 16px);
      background:var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      max-width: var(--maxw);
      margin: 12px auto 28px;
    }
    .pageWrap{
      max-width: var(--readerMax);
      margin: 0 auto;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid var(--border);
      background:var(--page-bg);
      position: relative;
    }
    .pageInner{ position: relative; will-change: transform, opacity; }

    /* Click/tap navigation zones (invisible) */
    .navZone{ position:absolute; top:0; bottom:0; width:32%; z-index:5; cursor: pointer; }
    .nav-left{ left:0; }
    .nav-right{ right:0; }

    /* Slide transitions */
    .slide-next{ animation: slideNext var(--slide-duration) var(--slide-ease); }
    .slide-prev{ animation: slidePrev var(--slide-duration) var(--slide-ease); }
    @keyframes slideNext{ 0%{ transform: translateX(var(--slide-distance)); opacity:.0; } 100%{ transform: translateX(0); opacity:1; } }
    @keyframes slidePrev{ 0%{ transform: translateX(calc(var(--slide-distance) * -1)); opacity:.0; } 100%{ transform: translateX(0); opacity:1; } }

    .skeleton{
      position:relative; overflow:hidden; border-radius:14px;
      aspect-ratio: 7 / 10; background: linear-gradient(90deg, #f2f3f7 25%, #f8f9fb 37%, #f2f3f7 63%);
      background-size: 400% 100%; animation: shimmer 1.1s infinite linear;
    }
    body.dark .skeleton{ background: linear-gradient(90deg, #1b2130 25%, #20273a 37%, #1b2130 63%); }
    @keyframes shimmer{ 0%{background-position:0 0} 100%{background-position:-135% 0} }
    .pageImg{ display:block; width:100%; height:auto; opacity:0; transition: opacity .25s ease; user-select:none; -webkit-user-drag:none; background:#fff; }

    .readerFoot{
      display:flex; align-items:center; gap:12px; justify-content:space-between; flex-wrap:wrap;
      padding: 10px 0 0;
    }
    .muted{ color: var(--muted) }
    .control{ display:flex; align-items:center; gap:10px; flex-wrap: wrap; }

    .hidden{ display:none !important; }

    /* -------- Fullscreen mode (white surround, no clipping) -------- */
    body.fs{ background:#fff; }
    body.fs .wrap{ max-width:none; padding: 0; }
    body.fs .page-head, body.fs .readerFoot{ display:none !important; }
    body.fs .readerBody{
      border:none; border-radius:0; box-shadow:none; background:#fff; margin:0;
      min-height:100vh; display:flex; align-items:center; justify-content:center;
    }
    body.fs .pageWrap{
      width:auto; max-width:100vw; border:none; border-radius:0; background:#fff; overflow:visible;
    }
    body.fs .pageImg{
      height:100vh; width:auto; max-width:100vw;
      display:block; margin:0 auto;
    }
  </style>
</head>
<body>
  <!-- Icons -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="i-arrow" viewBox="0 0 24 24">
      <path d="M13 5l7 7-7 7M5 12h14" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
    <symbol id="i-full" viewBox="0 0 24 24">
      <path d="M4 9V4h5M20 9V4h-5M4 15v5h5M20 15v5h-5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
    <symbol id="i-moon" viewBox="0 0 24 24">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
    <symbol id="i-sun" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="1.8"/>
      <path d="M12 1v3M12 20v3M4.22 4.22 6.34 6.34M17.66 17.66 19.78 19.78M1 12h3M20 12h3M4.22 19.78 6.34 17.66M17.66 6.34 19.78 4.22" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
    </symbol>
    <symbol id="i-download" viewBox="0 0 24 24">
      <path d="M12 3v12M7 10l5 5 5-5M5 21h14" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
  </svg>

  <!-- LIST VIEW -->
  <div id="listView" class="wrap">
    <header class="hero" aria-labelledby="title">
      <h1 id="title">The Clear Qur’an — Mustafa Khattab (English)</h1>
      <p class="subtitle">
        A clean reader for the English translation <em>The Clear Qur’an</em> by Dr. Mustafa Khattab. Browse all 114 sūrahs and open a fast, image-based page view. Navigation works with clicks/taps at the page edges, swipes, arrow keys, and a distraction-free full-screen mode.
      </p>
      <div class="control" style="gap:10px; margin-top:6px;">
        <button id="btnTheme" type="button" class="btn" aria-label="Toggle light/dark mode">
          <svg id="iconTheme" width="16" height="16" aria-hidden="true"><use href="#i-moon"/></svg> Theme
        </button>
        <a class="btn" href="https://teostoolsquran.s3.eu-west-2.amazonaws.com/clearquran/english.pdf" download aria-label="Download PDF">
          <svg width="16" height="16" aria-hidden="true"><use href="#i-download"/></svg> Download PDF
        </a>
      </div>
    </header>

    <section class="panel" aria-labelledby="surah-list-heading">
      <h2 id="surah-list-heading" class="visually-hidden">Surah list</h2>
      <div class="grid" id="surahGrid" role="list"></div>
    </section>
  </div>

  <!-- READER VIEW -->
  <div id="readerView" class="hidden">
    <div class="page-head wrap" aria-live="polite">
      <div class="title-group">
        <div id="readerTitle" class="readerTitle">Surah</div>
        <div id="readerSub" class="readerSub">The Clear Qur’an · Page</div>
      </div>
      <div class="control" style="gap:8px;">
        <a class="btn" href="https://teostoolsquran.s3.eu-west-2.amazonaws.com/clearquran/english.pdf" download aria-label="Download PDF">
          <svg width="16" height="16" aria-hidden="true"><use href="#i-download"/></svg> Download PDF
        </a>
        <button id="btnThemeReader" type="button" class="btn" aria-label="Toggle light/dark mode">
          <svg id="iconThemeReader" width="16" height="16" aria-hidden="true"><use href="#i-moon"/></svg> Theme
        </button>
        <button id="btnFull" type="button" class="btn" aria-label="Enter full screen">
          <svg width="16" height="16" aria-hidden="true"><use href="#i-full"/></svg> Full Screen
        </button>
        <a id="btnBack" class="btn" href="#" aria-label="Back to surah list">Back to List</a>
      </div>
    </div>

    <div class="readerBody wrap">
      <div class="pageWrap" id="pageWrap">
        <div class="pageInner" id="pageInner">
          <div class="skeleton" id="skeleton" aria-hidden="true"></div>
          <img id="pageImg" class="pageImg" src="" alt="" decoding="async" fetchpriority="high"/>
          <!-- Invisible click/tap zones for quick nav (LTR) -->
          <div class="navZone nav-left" id="tapLeft" aria-label="Previous page (left)"></div>
          <div class="navZone nav-right" id="tapRight" aria-label="Next page (right)"></div>
        </div>
      </div>

      <div class="readerFoot">
        <div class="control" style="gap:8px;">
          <label for="pageInput" class="muted">Page</label>
          <input id="pageInput" type="number" min="1" max="694" step="1" inputmode="numeric" style="width:92px; height:36px; border-radius:10px; border:1px solid var(--border); padding:0 10px;" />
          <button type="button" class="btn" id="btnGo">Go</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      /* ---------- CONFIG ---------- */
      const TOTAL_PAGES = 694;
      const S3_BASE = "https://teostoolsquran.s3.eu-west-2.amazonaws.com/clearquran/clearquran/";
      const THEME_KEY = "clearquran:theme"; // 'light' | 'dark'

      /* ---------- SURAH NAMES ---------- */
      const SURAH_NAMES = [
        "Al-Fatiha","Al-Baqarah","Aali Imran","An-Nisa","Al-Ma’idah","Al-An’am","Al-A’raf","Al-Anfal","At-Tawbah","Yunus",
        "Hud","Yusuf","Ar-Ra’d","Ibrahim","Al-Hijr","An-Nahl","Al-Isra","Al-Kahf","Maryam","Ta-Ha",
        "Al-Anbiya","Al-Hajj","Al-Mu’minun","An-Nur","Al-Furqan","Ash-Shu’ara","An-Naml","Al-Qasas","Al-Ankabut","Ar-Rum",
        "Luqman","As-Sajda","Al-Ahzab","Saba","Fatir","Ya-Sin","As-Saffat","Sad","Az-Zumar","Ghafir",
        "Fussilat","Ash-Shura","Az-Zukhruf","Ad-Dukhan","Al-Jathiya","Al-Ahqaf","Muhammad","Al-Fath","Al-Hujurat","Qaf",
        "Adh-Dhariyat","At-Tur","An-Najm","Al-Qamar","Ar-Rahman","Al-Waqia","Al-Hadid","Al-Mujadila","Al-Hashr","Al-Mumtahina",
        "As-Saff","Al-Jumu’a","Al-Munafiqun","At-Taghabun","At-Talaq","At-Tahrim","Al-Mulk","Al-Qalam","Al-Haqqa","Al-Ma’arij",
        "Nuh","Al-Jinn","Al-Muzzammil","Al-Muddathir","Al-Qiyama","Al-Insan","Al-Mursalat","An-Naba","An-Nazi’at","Abasa",
        "At-Takwir","Al-Infitar","Al-Mutaffifin","Al-Inshiqaq","Al-Buruj","At-Tariq","Al-A’la","Al-Ghashiya","Al-Fajr","Al-Balad",
        "Ash-Shams","Al-Layl","Ad-Duha","Ash-Sharh","At-Tin","Al-Alaq","Al-Qadr","Al-Bayyina","Az-Zalzalah","Al-Adiyat",
        "Al-Qari’a","At-Takathur","Al-Asr","Al-Humazah","Al-Fil","Quraysh","Al-Ma’un","Al-Kawthar","Al-Kafirun","An-Nasr",
        "Al-Masad","Al-Ikhlas","Al-Falaq","An-Nas"
      ];

      /* ---------- SURAH START PAGES (exactly as provided) ---------- */
      const SURAH_START_PAGE = {
        1:33, 2:34, 3:68, 4:88, 5:109, 6:125, 7:143, 8:162, 9:170, 10:185,
        11:196, 12:208, 13:219, 14:225, 15:230, 16:235, 17:247, 18:257, 19:267, 20:274,
        21:283, 22:291, 23:299, 24:306, 25:314, 26:321, 27:329, 28:336, 29:345, 30:352,
        31:358, 32:362, 33:365, 34:373, 35:379, 36:384, 37:389, 38:396, 39:401, 40:409,
        41:417, 42:422, 43:428, 44:434, 45:437, 46:441, 47:445, 48:449, 49:453, 50:456,
        51:459, 52:462, 53:465, 54:468, 55:471, 56:474, 57:477, 58:481, 59:485, 60:488,
        61:491, 62:493, 63:495, 64:497, 65:499, 66:501, 67:504, 68:507, 69:510, 70:513,
        71:515, 72:517, 73:519, 74:521, 75:523, 76:525, 77:527, 78:529, 79:531, 80:533,
        81:535, 82:537, 83:538, 84:540, 85:542, 86:544, 87:545, 88:546, 89:547, 90:549,
        91:550, 92:551, 93:552, 94:553, 95:554, 96:555, 97:556, 98:557, 99:558, 100:559,
        101:560, 102:561, 103:562, 104:563, 105:564, 106:565, 107:566, 108:567, 109:568, 110:569,
        111:570, 112:571, 113:572, 114:573
      };

      /* ---------- ELEMENTS ---------- */
      const listView   = document.getElementById('listView');
      const readerView = document.getElementById('readerView');
      const grid       = document.getElementById('surahGrid');

      const readerTitle = document.getElementById('readerTitle');
      const readerSub   = document.getElementById('readerSub');
      const btnBack     = document.getElementById('btnBack');
      const btnFull     = document.getElementById('btnFull');

      const btnTheme = document.getElementById('btnTheme');
      const iconTheme = document.getElementById('iconTheme');
      const btnThemeReader = document.getElementById('btnThemeReader');
      const iconThemeReader = document.getElementById('iconThemeReader');

      const pageWrap  = document.getElementById('pageWrap');
      const pageInner = document.getElementById('pageInner');
      const img       = document.getElementById('pageImg');
      const skeleton  = document.getElementById('skeleton');
      const pageInput = document.getElementById('pageInput');
      const btnGo     = document.getElementById('btnGo');

      const tapLeft   = document.getElementById('tapLeft');
      const tapRight  = document.getElementById('tapRight');

      /* ---------- STATE ---------- */
      const clamp = (n, a, b) => Math.min(b, Math.max(a, n));
      let currentPage = 1;
      let isNavigating = false;

      /* ---------- THEME ---------- */
      function applyTheme(theme){
        if(theme === 'dark'){ document.body.classList.add('dark'); }
        else { document.body.classList.remove('dark'); theme = 'light'; }
        try{ localStorage.setItem(THEME_KEY, theme); }catch(e){}
        const sym = theme === 'dark' ? '#i-sun' : '#i-moon';
        iconTheme.innerHTML = `<use href="${sym}"/>`;
        iconThemeReader.innerHTML = `<use href="${sym}"/>`;
      }
      function toggleTheme(){
        applyTheme(document.body.classList.contains('dark') ? 'light' : 'dark');
      }
      // Init theme
      (function(){
        let t='light'; try{ const v=localStorage.getItem(THEME_KEY); if(v) t=v; }catch(e){}
        applyTheme(t);
      })();

      /* ---------- HELPERS ---------- */
      function imageUrl(page){ return S3_BASE + "english-" + page + ".png"; }

      const STARTS = Object.keys(SURAH_START_PAGE)
        .map(k => [SURAH_START_PAGE[k], parseInt(k,10)])
        .sort((a,b) => a[0] === b[0] ? a[1]-b[1] : a[0]-b[0]);

      function surahByPage(page){
        let result = 1;
        for (let i=0;i<STARTS.length;i++){
          const [start, sNum] = STARTS[i];
          if (start === page) return sNum;
          if (start < page) result = sNum;
          if (start > page) break;
        }
        return result;
      }

      function surahStartPage(n){ return SURAH_START_PAGE[n] || 1; }

      function updateHeaderForPage(page){
        const sNum = surahByPage(page);
        const name = SURAH_NAMES[sNum-1] || "Surah";
        readerTitle.textContent = sNum + ". " + name;
        readerSub.textContent = "The Clear Qur’an (English) · Page " + page;
        const desiredHash = "#/" + sNum;
        if (location.hash !== desiredHash) history.replaceState(null, "", desiredHash);
      }

      function addSlideAnimation(direction){
        pageInner.classList.remove('slide-next','slide-prev');
        void pageInner.offsetWidth;
        if (direction === 1) pageInner.classList.add('slide-next');
        else if (direction === -1) pageInner.classList.add('slide-prev');
      }

      function loadPage(page, direction = 0){
        const target = clamp(parseInt(page,10)||1, 1, TOTAL_PAGES);
        currentPage = target;
        pageInput.value = target;
        const url = imageUrl(target);

        isNavigating = true;
        skeleton.style.display = 'block';
        img.style.opacity = '0';
        img.alt = "The Clear Qur’an — page " + target;

        if (direction !== 0) addSlideAnimation(direction);

        const onLoad = () => {
          img.removeEventListener('load', onLoad);
          img.removeEventListener('error', onError);
          requestAnimationFrame(() => {
            skeleton.style.display = 'none';
            img.style.opacity = '1';
            updateHeaderForPage(target);
            setTimeout(() => { isNavigating = false; }, parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--slide-duration')) || 220);
          });
        };
        const onError = () => {
          img.removeEventListener('load', onLoad);
          img.removeEventListener('error', onError);
          skeleton.style.display = 'none';
          img.alt = "Failed to load. Open in new tab: " + url;
          isNavigating = false;
        };

        img.addEventListener('load', onLoad, { once:true });
        img.addEventListener('error', onError, { once:true });
        img.src = url;
      }

      function navigate(delta){
        if (!readerView || listView.classList.contains('hidden') === false) return;
        if (isNavigating) return;
        const next = clamp(currentPage + delta, 1, TOTAL_PAGES);
        if (next === currentPage) return;
        loadPage(next, delta > 0 ? 1 : -1);
      }

      /* ---------- BUILD SURAH LIST ---------- */
      function buildList(){
        if (grid.hasChildNodes()) return;
        SURAH_NAMES.forEach((name,i) => {
          const num = i + 1;
          const a = document.createElement('a');
          a.href = "#/" + num;
          a.className = 'surah';
          a.setAttribute('role','listitem');
          a.setAttribute('aria-label', `Open reader for Surah ${num}: ${name}`);

          const meta = document.createElement('div'); meta.className='meta';
          const numEl = document.createElement('div'); numEl.className='num'; numEl.textContent = num;
          const nameEl = document.createElement('div'); nameEl.className='name'; nameEl.textContent = name;
          meta.appendChild(numEl); meta.appendChild(nameEl);

          const badge = document.createElement('div'); badge.className='badge'; badge.textContent='Open';
          const arrow = document.createElementNS('http://www.w3.org/2000/svg','svg');
          arrow.setAttribute('class','arrow'); arrow.setAttribute('width','18'); arrow.setAttribute('height','18');
          arrow.setAttribute('viewBox','0 0 24 24'); arrow.setAttribute('aria-hidden','true');
          arrow.innerHTML = '<path d="M13 5l7 7-7 7M5 12h14" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>';

          a.appendChild(meta); a.appendChild(badge); a.appendChild(arrow);
          grid.appendChild(a);
        });
      }

      /* ---------- VIEW SWITCH ---------- */
      function showList(){
        listView.classList.remove('hidden');
        readerView.classList.add('hidden');
        document.body.classList.remove('fs');
        window.scrollTo({ top: 0, behavior: 'instant' in window ? 'instant' : 'auto' });
      }

      function showReaderForSurah(surahNum){
        const n = parseInt(surahNum,10);
        const valid = Number.isInteger(n) && n >= 1 && n <= 114;
        const name = valid ? SURAH_NAMES[n-1] : "Surah";
        const start = valid ? SURAH_START_PAGE[n] : 1;

        readerTitle.textContent = (valid ? (n + ". " + name) : "Surah");
        readerSub.textContent   = "The Clear Qur’an (English) · Page " + start;

        loadPage(start, 0);

        btnBack.setAttribute('href', '#');
        listView.classList.add('hidden');
        readerView.classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'instant' in window ? 'instant' : 'auto' });
      }

      function onRoute(){
        const m = location.hash.trim().match(/^#\/(\d{1,3})$/);
        if (m) showReaderForSurah(parseInt(m[1],10)); else showList();
      }

      /* ---------- INPUTS & NAV ---------- */
      // Theme toggle buttons
      btnTheme.addEventListener('click', toggleTheme);
      btnThemeReader.addEventListener('click', toggleTheme);

      // Keyboard (LTR): RIGHT = NEXT, LEFT = PREV
      window.addEventListener('keydown', (e) => {
        if (readerView.classList.contains('hidden')) return;
        if (e.key === 'ArrowRight') { e.preventDefault(); navigate(+1); }
        if (e.key === 'ArrowLeft')  { e.preventDefault(); navigate(-1); }
        if (e.key === 'Escape' && document.body.classList.contains('fs')) { e.preventDefault(); document.body.classList.remove('fs'); }
      }, { passive:false });

      // Touch swipe (LTR)
      let touchStartX = 0, touchStartY = 0, touchStartT = 0, swiping = false;
      const SWIPE_THRESHOLD_PX = 40, SWIPE_MAX_OFFAXIS  = 60, SWIPE_MAX_TIME_MS  = 600;

      pageWrap.addEventListener('touchstart', (e) => {
        if (readerView.classList.contains('hidden')) return;
        if (!e.touches || e.touches.length !== 1) return;
        const t = e.touches[0];
        touchStartX = t.clientX; touchStartY = t.clientY; touchStartT = Date.now(); swiping = true;
      }, { passive:true });

      pageWrap.addEventListener('touchmove', (e) => {
        if (!swiping) return;
        const t = e.touches[0], dx = t.clientX - touchStartX, dy = t.clientY - touchStartY;
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 10) e.preventDefault();
      }, { passive:false });

      pageWrap.addEventListener('touchend', (e) => {
        if (!swiping) return; swiping = false;
        const dt = Date.now() - touchStartT; if (dt > SWIPE_MAX_TIME_MS) return;
        const t = e.changedTouches[0], dx = t.clientX - touchStartX, dy = t.clientY - touchStartY;
        if (Math.abs(dx) >= SWIPE_THRESHOLD_PX && Math.abs(dy) <= SWIPE_MAX_OFFAXIS) {
          if (dx < 0) navigate(+1); else navigate(-1);
        }
      }, { passive:true });

      // Edge click/tap zones (LTR)
      tapLeft.addEventListener('click', () => navigate(-1));
      tapRight.addEventListener('click', () => navigate(+1));

      // Page input
      btnGo.addEventListener('click', () => loadPage(pageInput.value, 0));
      pageInput.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); loadPage(pageInput.value, 0); } });

      // Full-screen toggle
      btnFull.addEventListener('click', (e) => { e.stopPropagation(); document.body.classList.toggle('fs'); });
      document.addEventListener('click', (e) => {
        if (!document.body.classList.contains('fs')) return;
        if (!pageWrap.contains(e.target)) document.body.classList.remove('fs');
      });

      // Back to list
      btnBack.addEventListener('click', (e) => { e.preventDefault(); location.hash = '#/'; });

      // Router & init
      window.addEventListener('hashchange', onRoute, { passive:true });
      buildList();
      onRoute();

      // Layout polish
      let lastW = window.innerWidth;
      window.addEventListener('resize', () => {
        const w = window.innerWidth;
        if (Math.abs(w - lastW) > 120) { window.scrollTo({ top: 0 }); }
        lastW = w;
      }, { passive:true });
    })();
  </script>
</body>
</html>
